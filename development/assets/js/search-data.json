{"0": {
    "doc": "API Reference",
    "title": "API Reference",
    "content": "# API Reference Complete reference documentation for all public methods and types in the TLE92466ED driver. ## Source Code - **Main Header**: [`inc/tle92466ed.hpp`](../inc/tle92466ed.hpp) - **SPI Interface**: [`inc/tle92466ed_spi_interface.hpp`](../inc/tle92466ed_spi_interface.hpp) - **Registers**: [`inc/tle92466ed_registers.hpp`](../inc/tle92466ed_registers.hpp) - **Implementation**: [`src/tle92466ed.cpp`](../src/tle92466ed.cpp) ## Core Class ### `Driver` Main driver class for interfacing with the TLE92466ED Six-Channel Low-Side Solenoid Driver IC. **Template Parameter**: `CommType` - Your SPI interface implementation (must inherit from `tle92466ed::SpiInterface`) **Location**: [`inc/tle92466ed.hpp#L289`](../inc/tle92466ed.hpp#L289) **Constructor:** ```cpp explicit Driver(CommType& comm) noexcept; ```text **Location**: [`inc/tle92466ed.hpp#L300`](../inc/tle92466ed.hpp#L300) ## Methods ### Initialization and Mode Control | Method | Signature | Location |--------|-----------|----------| `Init()` | `DriverResult Init() noexcept` | [`inc/tle92466ed.hpp#L343`](../inc/tle92466ed.hpp#L343) | `EnterMissionMode()` | `DriverResult EnterMissionMode() noexcept` | [`inc/tle92466ed.hpp#L356`](../inc/tle92466ed.hpp#L356) | `EnterConfigMode()` | `DriverResult EnterConfigMode() noexcept` | [`inc/tle92466ed.hpp#L367`](../inc/tle92466ed.hpp#L367) | `IsMissionMode()` | `bool IsMissionMode() const noexcept` | [`inc/tle92466ed.hpp#L373`](../inc/tle92466ed.hpp#L373) | `IsConfigMode()` | `bool IsConfigMode() const noexcept` | [`inc/tle92466ed.hpp#L381`](../inc/tle92466ed.hpp#L381) | `IsInitialized()` | `bool IsInitialized() const noexcept` | [`inc/tle92466ed.hpp#L785`](../inc/tle92466ed.hpp#L785) | ### Global Configuration | Method | Signature | Location |--------|-----------|----------| `ConfigureGlobal()` | `DriverResult ConfigureGlobal(const GlobalConfig& config) noexcept` | [`inc/tle92466ed.hpp#L397`](../inc/tle92466ed.hpp#L397) | `SetCrcEnabled()` | `DriverResult SetCrcEnabled(bool enabled) noexcept` | [`inc/tle92466ed.hpp#L405`](../inc/tle92466ed.hpp#L405) | `SetVbatThresholds()` | `DriverResult SetVbatThresholds(float uv_voltage, float ov_voltage) noexcept` | [`inc/tle92466ed.hpp#L421`](../inc/tle92466ed.hpp#L421) | `SetVbatThresholdsRaw()` | `DriverResult SetVbatThresholdsRaw(uint8_t uv_threshold, uint8_t ov_threshold) noexcept` | [`inc/tle92466ed.hpp#L433`](../inc/tle92466ed.hpp#L433) | ### Channel Control | Method | Signature | Location |--------|-----------|----------| `EnableChannel()` | `DriverResult EnableChannel(Channel channel, bool enabled) noexcept` | [`inc/tle92466ed.hpp#L448`](../inc/tle92466ed.hpp#L448) | `EnableChannels()` | `DriverResult EnableChannels(uint8_t channel_mask) noexcept` | [`inc/tle92466ed.hpp#L456`](../inc/tle92466ed.hpp#L456) | `EnableAllChannels()` | `DriverResult EnableAllChannels() noexcept` | [`inc/tle92466ed.hpp#L461`](../inc/tle92466ed.hpp#L461) | `DisableAllChannels()` | `DriverResult DisableAllChannels() noexcept` | [`inc/tle92466ed.hpp#L466`](../inc/tle92466ed.hpp#L466) | `SetChannelMode()` | `DriverResult SetChannelMode(Channel channel, ChannelMode mode) noexcept` | [`inc/tle92466ed.hpp#L476`](../inc/tle92466ed.hpp#L476) | `SetParallelOperation()` | `DriverResult SetParallelOperation(ParallelPair pair, bool enabled) noexcept` | [`inc/tle92466ed.hpp#L486`](../inc/tle92466ed.hpp#L486) | ### Current Control | Method | Signature | Location |--------|-----------|----------| `SetCurrentSetpoint()` | `DriverResult SetCurrentSetpoint(Channel channel, uint16_t current_ma, bool parallel_mode = false) noexcept` | [`inc/tle92466ed.hpp#L511`](../inc/tle92466ed.hpp#L511) | `GetCurrentSetpoint()` | `DriverResult GetCurrentSetpoint(Channel channel, bool parallel_mode = false) noexcept` | [`inc/tle92466ed.hpp#L521`](../inc/tle92466ed.hpp#L521) | ### PWM Configuration | Method | Signature | Location |--------|-----------|----------| `ConfigurePwmPeriod()` | `DriverResult ConfigurePwmPeriod(Channel channel, float period_us) noexcept` | [`inc/tle92466ed.hpp#L542`](../inc/tle92466ed.hpp#L542) | `ConfigurePwmPeriodRaw()` | `DriverResult ConfigurePwmPeriodRaw(Channel channel, uint8_t period_mantissa, uint8_t period_exponent, bool low_freq_range = false) noexcept` | [`inc/tle92466ed.hpp#L559`](../inc/tle92466ed.hpp#L559) | ### Dither Configuration | Method | Signature | Location |--------|-----------|----------| `ConfigureDither()` | `DriverResult ConfigureDither(Channel channel, float amplitude_ma, float frequency_hz, bool parallel_mode = false) noexcept` | [`inc/tle92466ed.hpp#L583`](../inc/tle92466ed.hpp#L583) | `ConfigureDitherRaw()` | `DriverResult ConfigureDitherRaw(Channel channel, uint16_t step_size, uint8_t num_steps, uint8_t flat_steps) noexcept` | [`inc/tle92466ed.hpp#L604`](../inc/tle92466ed.hpp#L604) | ### Channel Configuration | Method | Signature | Location |--------|-----------|----------| `ConfigureChannel()` | `DriverResult ConfigureChannel(Channel channel, const ChannelConfig& config) noexcept` | [`inc/tle92466ed.hpp#L615`](../inc/tle92466ed.hpp#L615) | ### Status and Diagnostics | Method | Signature | Location |--------|-----------|----------| `GetDeviceStatus()` | `DriverResult GetDeviceStatus() noexcept` | [`inc/tle92466ed.hpp#L627`](../inc/tle92466ed.hpp#L627) | `GetChannelDiagnostics()` | `DriverResult GetChannelDiagnostics(Channel channel) noexcept` | [`inc/tle92466ed.hpp#L635`](../inc/tle92466ed.hpp#L635) | `GetAverageCurrent()` | `DriverResult GetAverageCurrent(Channel channel, bool parallel_mode = false) noexcept` | [`inc/tle92466ed.hpp#L644`](../inc/tle92466ed.hpp#L644) | `GetDutyCycle()` | `DriverResult GetDutyCycle(Channel channel) noexcept` | [`inc/tle92466ed.hpp#L653`](../inc/tle92466ed.hpp#L653) | ### Voltage Monitoring | Method | Signature | Location |--------|-----------|----------| `GetVbatVoltage()` | `DriverResult GetVbatVoltage() noexcept` | [`inc/tle92466ed.hpp#L660`](../inc/tle92466ed.hpp#L660) | `GetVioVoltage()` | `DriverResult GetVioVoltage() noexcept` | [`inc/tle92466ed.hpp#L667`](../inc/tle92466ed.hpp#L667) | `GetVddVoltage()` | `DriverResult GetVddVoltage() noexcept` | [`inc/tle92466ed.hpp#L674`](../inc/tle92466ed.hpp#L674) | `GetVbatThresholds()` | `DriverResult GetVbatThresholds(uint16_t& uv_threshold, uint16_t& ov_threshold) noexcept` | [`inc/tle92466ed.hpp#L683`](../inc/tle92466ed.hpp#L683) | ### Fault Management | Method | Signature | Location |--------|-----------|----------| `ClearFaults()` | `DriverResult ClearFaults() noexcept` | [`inc/tle92466ed.hpp#L698`](../inc/tle92466ed.hpp#L698) | `HasAnyFault()` | `DriverResult HasAnyFault() noexcept` | [`inc/tle92466ed.hpp#L705`](../inc/tle92466ed.hpp#L705) | `GetAllFaults()` | `DriverResult GetAllFaults() noexcept` | [`inc/tle92466ed.hpp#L716`](../inc/tle92466ed.hpp#L716) | `PrintAllFaults()` | `DriverResult PrintAllFaults() noexcept` | [`inc/tle92466ed.hpp#L727`](../inc/tle92466ed.hpp#L727) | `IsFault()` | `DriverResult IsFault(bool print_faults = false) noexcept` | [`inc/tle92466ed.hpp#L895`](../inc/tle92466ed.hpp#L895) | ### Watchdog Management | Method | Signature | Location |--------|-----------|----------| `ReloadSpiWatchdog()` | `DriverResult ReloadSpiWatchdog(uint16_t reload_value) noexcept` | [`inc/tle92466ed.hpp#L753`](../inc/tle92466ed.hpp#L753) | ### Device Information | Method | Signature | Location |--------|-----------|----------| `GetIcVersion()` | `DriverResult GetIcVersion() noexcept` | [`inc/tle92466ed.hpp#L764`](../inc/tle92466ed.hpp#L764) | `GetChipId()` | `DriverResult> GetChipId() noexcept` | [`inc/tle92466ed.hpp#L771`](../inc/tle92466ed.hpp#L771) | `VerifyDevice()` | `DriverResult VerifyDevice() noexcept` | [`inc/tle92466ed.hpp#L778`](../inc/tle92466ed.hpp#L778) | ### GPIO Control | Method | Signature | Location |--------|-----------|----------| `SetReset()` | `DriverResult SetReset(bool reset) noexcept` | [`inc/tle92466ed.hpp#L807`](../inc/tle92466ed.hpp#L807) | `HoldReset()` | `DriverResult HoldReset() noexcept` | [`inc/tle92466ed.hpp#L818`](../inc/tle92466ed.hpp#L818) | `ReleaseReset()` | `DriverResult ReleaseReset() noexcept` | [`inc/tle92466ed.hpp#L831`](../inc/tle92466ed.hpp#L831) | `SetEnable()` | `DriverResult SetEnable(bool enable) noexcept` | [`inc/tle92466ed.hpp#L849`](../inc/tle92466ed.hpp#L849) | `Enable()` | `DriverResult Enable() noexcept` | [`inc/tle92466ed.hpp#L860`](../inc/tle92466ed.hpp#L860) | `Disable()` | `DriverResult Disable() noexcept` | [`inc/tle92466ed.hpp#L873`](../inc/tle92466ed.hpp#L873) | ### Register Access | Method | Signature | Location |--------|-----------|----------| `ReadRegister()` | `DriverResult ReadRegister(uint16_t address, uint8_t retries = 0) noexcept` | [`inc/tle92466ed.hpp#L911`](../inc/tle92466ed.hpp#L911) | `WriteRegister()` | `DriverResult WriteRegister(uint16_t address, uint16_t value, uint8_t retries = 0) noexcept` | [`inc/tle92466ed.hpp#L928`](../inc/tle92466ed.hpp#L928) | `ModifyRegister()` | `DriverResult ModifyRegister(uint16_t address, uint16_t mask, uint16_t value, uint8_t retries = 0) noexcept` | [`inc/tle92466ed.hpp#L940`](../inc/tle92466ed.hpp#L940) | ### System Control | Method | Signature | Location |--------|-----------|----------| `SoftwareReset()` | `DriverResult SoftwareReset() noexcept` | [`inc/tle92466ed.hpp#L737`](../inc/tle92466ed.hpp#L737) | ## Types ### Enumerations | Type | Values | Location |------|--------|----------| `DriverError` | `None`, `NotInitialized`, `HardwareError`, `InvalidChannel`, `InvalidParameter`, `DeviceNotResponding`, `WrongDeviceID`, `RegisterError`, `CRCError`, `FaultDetected`, `ConfigurationError`, `TimeoutError`, `WrongMode`, `SPIFrameError`, `WriteToReadOnly` | [`inc/tle92466ed.hpp#L79`](../inc/tle92466ed.hpp#L79) | `Channel` | `CH0`, `CH1`, `CH2`, `CH3`, `CH4`, `CH5`, `COUNT` | [`inc/tle92466ed_registers.hpp#L1053`](../inc/tle92466ed_registers.hpp#L1053) | `ChannelMode` | `OFF`, `ICC`, `DIRECT_DRIVE_SPI`, `DIRECT_DRIVE_DRV0`, `DIRECT_DRIVE_DRV1`, `FREE_RUN_MEAS` | [`inc/tle92466ed_registers.hpp#L1067`](../inc/tle92466ed_registers.hpp#L1067) | `ParallelPair` | `NONE`, `CH0_CH3`, `CH1_CH2`, `CH4_CH5` | [`inc/tle92466ed_registers.hpp#L1099`](../inc/tle92466ed_registers.hpp#L1099) | `SlewRate` | `SLOW_1V0_US`, `MEDIUM_2V5_US`, `FAST_5V0_US`, `FASTEST_10V0_US` | [`inc/tle92466ed_registers.hpp#L1079`](../inc/tle92466ed_registers.hpp#L1079) | `DiagCurrent` | `I_80UA`, `I_190UA`, `I_720UA`, `I_1250UA` | [`inc/tle92466ed_registers.hpp#L1089`](../inc/tle92466ed_registers.hpp#L1089) | ### Structures | Type | Description | Location |------|-------------|----------| `ChannelConfig` | Channel configuration structure | [`inc/tle92466ed.hpp#L109`](../inc/tle92466ed.hpp#L109) | `GlobalConfig` | Global configuration structure | [`inc/tle92466ed.hpp#L252`](../inc/tle92466ed.hpp#L252) | `DeviceStatus` | Global device status structure | [`inc/tle92466ed.hpp#L128`](../inc/tle92466ed.hpp#L128) | `ChannelDiagnostics` | Channel diagnostic information | [`inc/tle92466ed.hpp#L163`](../inc/tle92466ed.hpp#L163) | `FaultReport` | Comprehensive fault report structure | [`inc/tle92466ed.hpp#L192`](../inc/tle92466ed.hpp#L192) | ### Type Aliases | Type | Definition | Location |------|------------|----------| `DriverResult` | `std::expected` | [`inc/tle92466ed.hpp#L100`](../inc/tle92466ed.hpp#L100) | --- **Navigation** ‚¨ÖÔ∏è [Configuration](/hf-tle92466ed-driver/development/docs/configuration.html) | [Next: Examples ‚û°Ô∏è](/hf-tle92466ed-driver/development/docs/examples.html) | [Back to Index](/hf-tle92466ed-driver/development/docs/) ",
    "url": "/hf-tle92466ed-driver/development/docs/api_reference.html",
    
    "relUrl": "/docs/api_reference.html"
  },"1": {
    "doc": "Configuration",
    "title": "Configuration",
    "content": "# Configuration This guide covers all configuration options available for the TLE92466ED driver. ## Global Configuration ### Basic Global Setup ```cpp tle92466ed::GlobalConfig global_config; global_config.crc_enabled = true; global_config.spi_watchdog_enabled = true; global_config.clock_watchdog_enabled = true; global_config.vio_5v = false; // false = 3.3V, true = 5.0V global_config.vbat_uv_voltage = 4.0f; // UV threshold in volts global_config.vbat_ov_voltage = 41.0f; // OV threshold in volts global_config.spi_watchdog_reload = 1000; driver.ConfigureGlobal(global_config); ```text ### CRC Configuration ```cpp driver.SetCrcEnabled(true); // Enable CRC checking (recommended) ```cpp - **Enabled**: All SPI frames include CRC-8 (SAE J1850) for error detection - **Disabled**: No CRC checking (faster, but less reliable) ### VBAT Thresholds ```cpp // High-level API (recommended) driver.SetVbatThresholds(4.0f, 41.0f); // UV=4V, OV=41V // Low-level API (direct register control) driver.SetVbatThresholdsRaw(25, 253); // Register values ```cpp **Threshold Range**: 0V to ~41.4V (calculated as `register_value * 0.16208V`) ## Channel Configuration ### Basic Channel Setup ```cpp tle92466ed::ChannelConfig config; config.mode = tle92466ed::ChannelMode::ICC; config.current_setpoint_ma = 1500; // 1.5A config.slew_rate = tle92466ed::SlewRate::MEDIUM_2V5_US; config.diag_current = tle92466ed::DiagCurrent::I_80UA; config.open_load_threshold = 3; // 3/8 threshold driver.ConfigureChannel(tle92466ed::Channel::CH0, config); ```cpp ### Channel Modes #### ICC Mode (Integrated Current Control) ```cpp config.mode = tle92466ed::ChannelMode::ICC; ```cpp - **Purpose**: Precise current regulation with 15-bit resolution - **Use Case**: Solenoids, valves requiring constant current - **Features**: Automatic current regulation, PWM-based control #### Direct Drive Modes ```cpp // SPI-controlled on-time config.mode = tle92466ed::ChannelMode::DIRECT_DRIVE_SPI; // External pin control config.mode = tle92466ed::ChannelMode::DIRECT_DRIVE_DRV0; config.mode = tle92466ed::ChannelMode::DIRECT_DRIVE_DRV1; ```cpp - **Purpose**: Direct control via SPI or external pins - **Use Case**: Simple on/off control, external timing #### Free-Running Measurement ```cpp config.mode = tle92466ed::ChannelMode::FREE_RUN_MEAS; ```cpp - **Purpose**: Continuous current sensing without output control - **Use Case**: Diagnostics, current monitoring ### Current Settings ```cpp // Single channel mode (0-2000 mA) driver.SetCurrentSetpoint(tle92466ed::Channel::CH0, 1500); // 1.5A // Parallel mode (0-4000 mA) driver.SetCurrentSetpoint(tle92466ed::Channel::CH0, 3000, true); // 3A ```cpp **Current Range**: - **Single channel**: 0-2000 mA (1.5A typical continuous, 2.0A max) - **Parallel mode**: 0-4000 mA (2.7A typical continuous, 4.0A max) - **Resolution**: 15-bit (0.061mA per LSB single, 0.122mA parallel) ### PWM Configuration ```cpp // High-level API (recommended) driver.ConfigurePwmPeriod(tle92466ed::Channel::CH0, 100.0f); // 100 ¬µs period // Low-level API (direct control) driver.ConfigurePwmPeriodRaw(tle92466ed::Channel::CH0, 100, // mantissa 3, // exponent false); // low_freq_range ```cpp **PWM Period Range**: ~0.125 ¬µs to ~32.64 ms ### Dither Configuration ```cpp // High-level API (recommended) driver.ConfigureDither(tle92466ed::Channel::CH0, 50.0f, // 50 mA amplitude 1000.0f, // 1000 Hz frequency false); // not parallel mode // Low-level API (direct control) driver.ConfigureDitherRaw(tle92466ed::Channel::CH0, 100, // step_size 10, // num_steps 5); // flat_steps ```text **Dither Amplitude**: 0-1800 mA (configurable) ### Slew Rate ```cpp config.slew_rate = tle92466ed::SlewRate::SLOW_1V0_US; // 1.0 V/¬µs (low EMI) config.slew_rate = tle92466ed::SlewRate::MEDIUM_2V5_US; // 2.5 V/¬µs (standard) config.slew_rate = tle92466ed::SlewRate::FAST_5V0_US; // 5.0 V/¬µs (fast) config.slew_rate = tle92466ed::SlewRate::FASTEST_10V0_US; // 10.0 V/¬µs (maximum) ```cpp ## Parallel Operation ### Enabling Parallel Mode ```cpp // Pair channels 0 and 3 driver.SetParallelOperation(tle92466ed::ParallelPair::CH0_CH3, true); // Pair channels 1 and 2 driver.SetParallelOperation(tle92466ed::ParallelPair::CH1_CH2, true); // Pair channels 4 and 5 driver.SetParallelOperation(tle92466ed::ParallelPair::CH4_CH5, true); ```cpp **Parallel Pairs**: - CH0/CH3: Doubles current capability (up to 4A) - CH1/CH2: Doubles current capability (up to 4A) - CH4/CH5: Doubles current capability (up to 4A) **Note**: When in parallel mode, set current with `parallel_mode = true` parameter. ## Default Values ### Global Defaults - CRC: Enabled - SPI Watchdog: Enabled - Clock Watchdog: Enabled - VIO: 3.3V mode - VBAT UV: ~4V - VBAT OV: ~41V ### Channel Defaults - Mode: ICC - Current: 0 mA - Slew Rate: MEDIUM_2V5_US - Diagnostic Current: I_80UA - Open Load Threshold: 3/8 ## Next Steps - Review [Examples](/hf-tle92466ed-driver/development/docs/examples.html) for configuration examples - Check [API Reference](/hf-tle92466ed-driver/development/docs/api_reference.html) for all configuration methods - See [Troubleshooting](/hf-tle92466ed-driver/development/docs/troubleshooting.html) for configuration issues --- **Navigation** ‚¨ÖÔ∏è [Platform Integration](/hf-tle92466ed-driver/development/docs/platform_integration.html) | [Next: Examples ‚û°Ô∏è](/hf-tle92466ed-driver/development/docs/examples.html) | [Back to Index](/hf-tle92466ed-driver/development/docs/) ",
    "url": "/hf-tle92466ed-driver/development/docs/configuration.html",
    
    "relUrl": "/docs/configuration.html"
  },"2": {
    "doc": "Examples",
    "title": "Examples",
    "content": "# Examples This guide provides complete, working examples demonstrating various use cases for the TLE92466ED driver. ## Example 1: Basic Solenoid Control This example shows basic solenoid control with current regulation. ```cpp #include \"tle92466ed.hpp\" #include \"esp32_tle_comm_interface.hpp\" void app_main() { // 1. Create SPI interface auto hal = CreateEsp32TleCommInterface(); if (!hal || hal->Init().has_value() == false) { printf(\"HAL initialization failed\\n\"); return; } // 2. Create driver tle92466ed::Driver driver(*hal); // 3. Initialize if (auto result = driver.Init(); !result) { printf(\"Initialization failed\\n\"); return; } // 4. Configure channel 0 for 1.5A current control driver.SetChannelMode(tle92466ed::Channel::CH0, tle92466ed::ChannelMode::ICC); driver.SetCurrentSetpoint(tle92466ed::Channel::CH0, 1500); // 1.5A // 5. Enter Mission Mode driver.EnterMissionMode(); // 6. Enable channel driver.EnableChannel(tle92466ed::Channel::CH0, true); // 7. Monitor current while (true) { if (auto current = driver.GetAverageCurrent(tle92466ed::Channel::CH0); current) { printf(\"Channel 0 current: %u mA\\n\", *current); } vTaskDelay(pdMS_TO_TICKS(100)); } } ```cpp ## Example 2: Parallel Operation (High Current) This example demonstrates parallel channel operation for higher current capability. ```cpp void configure_high_current_solenoid() { auto hal = CreateEsp32TleCommInterface(); tle92466ed::Driver driver(*hal); driver.Init(); // Enter Config Mode driver.EnterConfigMode(); // Enable parallel operation CH0+CH3 driver.SetParallelOperation(tle92466ed::ParallelPair::CH0_CH3, true); // Configure both channels identically tle92466ed::ChannelConfig config; config.mode = tle92466ed::ChannelMode::ICC; config.current_setpoint_ma = 3500; // 3.5A total (parallel mode) config.slew_rate = tle92466ed::SlewRate::MEDIUM_2V5_US; driver.ConfigureChannel(tle92466ed::Channel::CH0, config); driver.ConfigureChannel(tle92466ed::Channel::CH3, config); // Enter Mission Mode and enable driver.EnterMissionMode(); driver.EnableChannel(tle92466ed::Channel::CH0, true); driver.EnableChannel(tle92466ed::Channel::CH3, true); printf(\"High-current mode active: 3.5A\\n\"); } ```cpp ## Example 3: Fault Monitoring This example shows how to monitor and handle faults. ```cpp void monitor_faults() { tle92466ed::Driver driver(*hal); driver.Init(); driver.EnterMissionMode(); // Enable channel driver.EnableChannel(tle92466ed::Channel::CH0, true); while (true) { // Check for faults if (auto has_fault = driver.HasAnyFault(); has_fault && *has_fault) { // Get detailed fault report if (auto faults = driver.GetAllFaults(); faults) { auto& report = *faults; if (report.vbat_uv) { printf(\"VBAT undervoltage detected!\\n\"); } if (report.channels[0].overcurrent) { printf(\"Channel 0 overcurrent!\\n\"); driver.DisableAllChannels(); } // Clear faults after handling driver.ClearFaults(); } } vTaskDelay(pdMS_TO_TICKS(100)); } } ```cpp ## Example 4: Multi-Channel Control This example demonstrates controlling multiple channels independently. ```cpp void multi_channel_control() { tle92466ed::Driver driver(*hal); driver.Init(); driver.EnterMissionMode(); // Configure multiple channels with different currents driver.SetChannelMode(tle92466ed::Channel::CH0, tle92466ed::ChannelMode::ICC); driver.SetChannelMode(tle92466ed::Channel::CH1, tle92466ed::ChannelMode::ICC); driver.SetChannelMode(tle92466ed::Channel::CH2, tle92466ed::ChannelMode::ICC); driver.SetCurrentSetpoint(tle92466ed::Channel::CH0, 1000); // 1A driver.SetCurrentSetpoint(tle92466ed::Channel::CH1, 1500); // 1.5A driver.SetCurrentSetpoint(tle92466ed::Channel::CH2, 800); // 0.8A // Enable all channels driver.EnableChannels(0x07); // Bits 0,1,2 = CH0, CH1, CH2 // Monitor all channels while (true) { for (uint8_t ch = 0; ch (ch)); current) { printf(\"CH%d: %u mA\\n\", ch, *current); } } vTaskDelay(pdMS_TO_TICKS(100)); } } ```text ## Example 5: PWM and Dither Configuration This example shows advanced PWM and dither configuration. ```cpp void advanced_current_control() { tle92466ed::Driver driver(*hal); driver.Init(); driver.EnterConfigMode(); // Configure channel 0 driver.SetChannelMode(tle92466ed::Channel::CH0, tle92466ed::ChannelMode::ICC); // Set PWM period to 100 ¬µs driver.ConfigurePwmPeriod(tle92466ed::Channel::CH0, 100.0f); // Configure dither: 50mA amplitude, 1000Hz frequency driver.ConfigureDither(tle92466ed::Channel::CH0, 50.0f, 1000.0f); // Set current driver.SetCurrentSetpoint(tle92466ed::Channel::CH0, 1500); driver.EnterMissionMode(); driver.EnableChannel(tle92466ed::Channel::CH0, true); } ```text ## Example 6: Complete Channel Configuration This example shows complete channel configuration using ChannelConfig structure. ```cpp void complete_channel_setup() { tle92466ed::Driver driver(*hal); driver.Init(); driver.EnterConfigMode(); // Complete channel configuration tle92466ed::ChannelConfig config; config.mode = tle92466ed::ChannelMode::ICC; config.current_setpoint_ma = 1500; config.slew_rate = tle92466ed::SlewRate::MEDIUM_2V5_US; config.diag_current = tle92466ed::DiagCurrent::I_80UA; config.open_load_threshold = 3; // 3/8 threshold config.pwm_period_mantissa = 100; config.pwm_period_exponent = 3; config.deep_dither_enabled = false; config.dither_step_size = 50; config.dither_steps = 10; config.dither_flat = 5; driver.ConfigureChannel(tle92466ed::Channel::CH0, config); driver.EnterMissionMode(); driver.EnableChannel(tle92466ed::Channel::CH0, true); } ```cpp ## Example 7: Voltage Monitoring This example demonstrates monitoring supply voltages. ```cpp void monitor_voltages() { tle92466ed::Driver driver(*hal); driver.Init(); while (true) { // Read voltages if (auto vbat = driver.GetVbatVoltage(); vbat) { printf(\"VBAT: %u mV\\n\", *vbat); } if (auto vio = driver.GetVioVoltage(); vio) { printf(\"VIO: %u mV\\n\", *vio); } if (auto vdd = driver.GetVddVoltage(); vdd) { printf(\"VDD: %u mV\\n\", *vdd); } vTaskDelay(pdMS_TO_TICKS(1000)); } } ```cpp ## Next Steps - Review the [API Reference](/hf-tle92466ed-driver/development/docs/api_reference.html) for all available methods - Check [Configuration](/hf-tle92466ed-driver/development/docs/configuration.html) for customization options - See [Troubleshooting](/hf-tle92466ed-driver/development/docs/troubleshooting.html) for common issues --- **Navigation** ‚¨ÖÔ∏è [Configuration](/hf-tle92466ed-driver/development/docs/configuration.html) | [Next: Troubleshooting ‚û°Ô∏è](/hf-tle92466ed-driver/development/docs/troubleshooting.html) | [Back to Index](/hf-tle92466ed-driver/development/docs/) ",
    "url": "/hf-tle92466ed-driver/development/docs/examples.html",
    
    "relUrl": "/docs/examples.html"
  },"3": {
    "doc": "Hardware Setup",
    "title": "Hardware Setup",
    "content": "# Hardware Setup This guide covers the physical connections and hardware requirements for the TLE92466ED Six-Channel Low-Side Solenoid Driver IC. ## Pin Connections ### Basic SPI Connections ```text MCU TLE92466ED ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 3.3V/5V ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ VIO GND ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ GND 5.5-41V ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ VBAT SCK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SCK MOSI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SI MISO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SO CS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CSN ```cpp ### Control Pins ```text MCU TLE92466ED ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ GPIO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ RESN (optional, active low reset) GPIO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ EN (optional, active high enable) GPIO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ FAULTN (optional, active low fault output) ```cpp ### Pin Descriptions | Pin | Name | Description | Required |-----|------|-------------|----------| VBAT | Power | Battery voltage supply (5.5V - 41V) | Yes | VIO | Power | SPI I/O voltage (3.0V - 5.5V, typically 3.3V or 5.0V) | Yes | VDD | Power | Internal 5V supply output (max 10mA load) | No | GND | Ground | Ground reference | Yes | SCK | Clock | SPI clock line (up to 10 MHz) | Yes | SI | Data In | SPI data input (MOSI) | Yes | SO | Data Out | SPI data output (MISO) | Yes | CSN | Chip Select | SPI chip select (active low) | Yes | RESN | Reset | Active-low reset (optional) | No | EN | Enable | Active-high global enable (optional) | No | FAULTN | Fault | Active-low fault indication (open drain, optional) | No | OUT0-5 | Outputs | Low-side switch outputs (6 channels) | Yes | ## Power Requirements - **VBAT (Battery Supply)**: 5.5V - 41V (12V or 24V typical for automotive) - **VIO (I/O Supply)**: 3.0V - 5.5V (3.3V or 5.0V typical) - **VDD (Internal 5V)**: Output from IC, max 10mA load - **Current per Channel**: Up to 2A single channel, 4A parallel mode - **Power Supply**: Clean supply with decoupling capacitors (100nF ceramic + 10¬µF tantalum recommended) ## SPI Configuration - **Mode**: SPI Mode 1 (CPOL=0, CPHA=1) - **Speed**: Up to 10 MHz - **Bit Order**: MSB first - **CS Polarity**: Active low (CSN) - **Data Format**: 32-bit frames with 8-bit CRC (SAE J1850) - **Frame Structure**: CRC[31:24] + Address[23:17] + R/W[16] + Data[15:0] ## Load Connections ### Single Channel Mode Connect the load between OUTx and VBAT (or positive supply): ```cpp VBAT ‚îÄ‚îÄ‚îÄ‚îÄ[Load]‚îÄ‚îÄ‚îÄ‚îÄ OUTx ‚îÄ‚îÄ‚îÄ‚îÄ GND ```cpp ### Parallel Channel Mode For higher current, connect channels in parallel (pairs: 0/3, 1/2, 4/5): ```cpp VBAT ‚îÄ‚îÄ‚îÄ‚îÄ[Load]‚îÄ‚îÄ‚îÄ‚îÄ OUT0 ‚îÄ‚îÄ‚îÄ‚îÄ GND ‚îî‚îÄ‚îÄ‚îÄ‚îÄ OUT3 ‚îÄ‚îÄ‚îÄ‚îÄ GND ```cpp ## Physical Layout Recommendations - Keep SPI traces short (< 10cm recommended) - Use ground plane for noise reduction - Place decoupling capacitors (100nF ceramic + 10¬µF tantalum) close to VBAT and VIO pins - Route clock and data lines away from noise sources - Keep high-current traces (OUT0-5) away from sensitive signals - Use appropriate trace widths for high-current paths (1A = ~20 mils minimum) - Add flyback diodes for inductive loads (solenoids, valves) ## Example Wiring Diagram ```text TLE92466ED ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê 12V/24V ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ VBAT ‚îÇ 3.3V ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ VIO ‚îÇ GND ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ GND ‚îÇ SCK ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ SCK ‚îÇ MOSI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ SI ‚îÇ MISO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ SO ‚îÇ CS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ CSN ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ OUT0 ‚îú‚îÄ‚îÄ‚îÄ[Solenoid]‚îÄ‚îÄ‚îÄ VBAT ‚îÇ ‚îÇ OUT1 ‚îú‚îÄ‚îÄ‚îÄ[Valve]‚îÄ‚îÄ‚îÄ VBAT ```cpp ## Protection Components ### Flyback Diodes For inductive loads (solenoids, valves), the TLE92466ED has internal protection, but external flyback diodes may be needed for very high inductance loads: ```cpp VBAT ‚îÄ‚îÄ‚îÄ‚îÄ[Flyback Diode]‚îÄ‚îÄ‚îÄ OUTx (cathode to VBAT) ```cpp ### Current Limiting The TLE92466ED has built-in overcurrent protection (OCP) and current regulation via ICC, but you may want to add external fuses for additional safety. ## Next Steps - Verify connections with a multimeter - Proceed to [Quick Start](/hf-tle92466ed-driver/development/docs/quickstart.html) to test the connection - Review [Platform Integration](/hf-tle92466ed-driver/development/docs/platform_integration.html) for software setup --- **Navigation** ‚¨ÖÔ∏è [Quick Start](/hf-tle92466ed-driver/development/docs/quickstart.html) | [Next: Platform Integration ‚û°Ô∏è](/hf-tle92466ed-driver/development/docs/platform_integration.html) | [Back to Index](/hf-tle92466ed-driver/development/docs/) ",
    "url": "/hf-tle92466ed-driver/development/docs/hardware_setup.html",
    
    "relUrl": "/docs/hardware_setup.html"
  },"4": {
    "doc": "HF-TLE92466ED Documentation",
    "title": "HF-TLE92466ED Documentation",
    "content": "# HF-TLE92466ED Documentation Welcome! This directory contains step-by-step guides for installing, building, and using the **HF-TLE92466ED** library. ## üìö Documentation Structure ### **Getting Started** 1. **[üõ†Ô∏è Installation](/hf-tle92466ed-driver/development/docs/installation.html)** ‚Äì Prerequisites and how to obtain the source 2. **[‚ö° Quick Start](/hf-tle92466ed-driver/development/docs/quickstart.html)** ‚Äì Minimal working example to get you running 3. **[üîå Hardware Setup](/hf-tle92466ed-driver/development/docs/hardware_setup.html)** ‚Äì Wiring diagrams and pin connections ### **Integration** 1. **[üîß Platform Integration](/hf-tle92466ed-driver/development/docs/platform_integration.html)** ‚Äì Implement the SPI interface for your platform 2. **[‚öôÔ∏è Configuration](/hf-tle92466ed-driver/development/docs/configuration.html)** ‚Äì Configuration options and settings ### **Reference** 1. **[üìñ API Reference](/hf-tle92466ed-driver/development/docs/api_reference.html)** ‚Äì Complete API documentation 2. **[üí° Examples](/hf-tle92466ed-driver/development/docs/examples.html)** ‚Äì Detailed example walkthroughs ### **Troubleshooting** 1. **[üêõ Troubleshooting](/hf-tle92466ed-driver/development/docs/troubleshooting.html)** ‚Äì Common issues and solutions --- ## üöÄ Quick Start Path **New to TLE92466ED?** Follow this recommended path: 1. Start with **[Installation](/hf-tle92466ed-driver/development/docs/installation.html)** to prepare your environment 2. Follow **[Hardware Setup](/hf-tle92466ed-driver/development/docs/hardware_setup.html)** to wire your hardware 3. Read **[Quick Start](/hf-tle92466ed-driver/development/docs/quickstart.html)** for a minimal working example 4. Check **[Platform Integration](/hf-tle92466ed-driver/development/docs/platform_integration.html)** to implement the SPI interface 5. Explore **[Examples](/hf-tle92466ed-driver/development/docs/examples.html)** for more advanced usage --- ## üí° Need Help? - **üêõ Found a bug?** Check the [Troubleshooting](/hf-tle92466ed-driver/development/docs/troubleshooting.html) guide - **‚ùì Have questions?** Review the [API Reference](/hf-tle92466ed-driver/development/docs/api_reference.html) - **üìù Want to contribute?** See the contributing guidelines in the main README --- **Navigation** ‚û°Ô∏è [Installation](/hf-tle92466ed-driver/development/docs/installation.html) ",
    "url": "/hf-tle92466ed-driver/development/docs/",
    
    "relUrl": "/docs/"
  },"5": {
    "doc": "Installation",
    "title": "Installation",
    "content": "# Installation This guide covers how to obtain and integrate the TLE92466ED driver library into your project. ## Prerequisites Before installing the driver, ensure you have: - **C++23 Compiler**: GCC 13+, Clang 16+, or MSVC 2022+ with `std::expected` support - **Build System**: Make, CMake, or ESP-IDF (depending on your platform) - **Platform SDK**: ESP-IDF, STM32 HAL, Arduino, or your platform's SPI driver ## Obtaining the Source ### Option 1: Git Clone ```bash git clone https://github.com/n3b3x/hf-tle92466ed-driver.git cd hf-tle92466ed-driver ```text ### Option 2: Copy Files Copy the following files into your project: ```cpp inc/ ‚îú‚îÄ‚îÄ tle92466ed.hpp ‚îú‚îÄ‚îÄ tle92466ed_spi_interface.hpp ‚îî‚îÄ‚îÄ tle92466ed_registers.hpp src/ ‚îî‚îÄ‚îÄ tle92466ed.cpp ```cpp ## Integration Methods ### Using CMake Add the driver as a subdirectory in your `CMakeLists.txt`: ```cmake add_subdirectory(external/hf-tle92466ed-driver) target_link_libraries(your_target PRIVATE hf_tle92466ed) target_include_directories(your_target PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/external/hf-tle92466ed-driver/inc ) ```cpp ### Using ESP-IDF Component The driver can be used as an ESP-IDF component. Add it to your `components` directory: ```cmake # In your main CMakeLists.txt idf_component_register( SRCS \"your_code.cpp\" INCLUDE_DIRS \".\" REQUIRES hf_tle92466ed ) ```cpp ### Manual Integration 1. Copy the driver files to your project 2. Add the `inc/` directory to your include path 3. Include the header: ```cpp #include \"tle92466ed.hpp\" ```cpp 4. Compile with C++23 support: ```bash g++ -std=c++23 -I inc/ your_code.cpp src/tle92466ed.cpp ```cpp ## Verification To verify the installation: 1. Include the header in a test file: ```cpp #include \"tle92466ed.hpp\" ```cpp 2. Compile a simple test: ```bash g++ -std=c++23 -I inc/ -c src/tle92466ed.cpp -o test.o ```cpp 3. If compilation succeeds, the library is properly installed. ## Next Steps - Follow the [Quick Start](/hf-tle92466ed-driver/development/docs/quickstart.html) guide to create your first application - Review [Hardware Setup](/hf-tle92466ed-driver/development/docs/hardware_setup.html) for wiring instructions - Check [Platform Integration](/hf-tle92466ed-driver/development/docs/platform_integration.html) to implement the SPI interface --- **Navigation** ‚¨ÖÔ∏è [Back to Index](/hf-tle92466ed-driver/development/docs/) | [Next: Quick Start ‚û°Ô∏è](/hf-tle92466ed-driver/development/docs/quickstart.html) ",
    "url": "/hf-tle92466ed-driver/development/docs/installation.html",
    
    "relUrl": "/docs/installation.html"
  },"6": {
    "doc": "Platform Integration Guide",
    "title": "Platform Integration Guide",
    "content": "# Platform Integration Guide This guide explains how to implement the hardware abstraction interface for the TLE92466ED driver on your platform. ## Understanding the SPI Interface The TLE92466ED driver uses a **polymorphic SPI interface** design for hardware abstraction. This design choice provides several critical benefits for embedded systems: ### Why This Design? #### 1. **Hardware Portability** - Write driver code once, run on any platform - Easy migration between MCUs (ESP32, STM32, Arduino, etc.) - Platform-specific code isolated in one class #### 2. **Type Safety** - Compile-time interface checking - Clear contract for required methods - Catch implementation errors at compile time #### 3. **Modern C++23** - Uses `std::expected` for error handling (no exceptions) - All functions `noexcept` for embedded safety - Zero-overhead abstractions ### How It Works ```cpp // Base interface class (from tle92466ed_spi_interface.hpp) class SpiInterface { public: virtual auto spiTransfer(std::span txData, std::span rxData) noexcept -> std::expected = 0; virtual void delayMicroseconds(uint32_t us) noexcept = 0; }; // Your implementation class MySpi : public SpiInterface { public: auto spiTransfer(std::span txData, std::span rxData) noexcept -> std::expected override { // Your platform-specific SPI code return {}; } void delayMicroseconds(uint32_t us) noexcept override { // Your delay implementation } }; ```cpp ## Interface Definition The TLE92466ED driver requires you to implement the following interface: ```cpp class SpiInterface { public: // Required methods (implement all of these) virtual auto spiTransfer(std::span txData, std::span rxData) noexcept -> std::expected = 0; virtual void delayMicroseconds(uint32_t us) noexcept = 0; // Optional control pin methods virtual auto SetGpioPin(ControlPin pin, ActiveLevel level) noexcept -> std::expected; virtual auto GetGpioPin(ControlPin pin) noexcept -> std::expected; }; ```cpp ## Implementation Steps ### Step 1: Create Your Implementation Class ```cpp #include \"tle92466ed_spi_interface.hpp\" class MyPlatformSPI : public tle92466ed::SpiInterface { private: // Your platform-specific members spi_device_handle_t spi_device_; // Example for ESP32 public: // Constructor MyPlatformSPI(spi_device_handle_t device) : spi_device_(device) {} // Implement required methods auto spiTransfer(std::span txData, std::span rxData) noexcept -> std::expected override { // Your transfer code - must handle 32-bit frames // TLE92466ED uses 32-bit SPI frames with CRC-8 return {}; } void delayMicroseconds(uint32_t us) noexcept override { // Your delay implementation } }; ```cpp ### Step 2: Platform-Specific Examples #### ESP32 (ESP-IDF) ```cpp #include \"driver/spi_master.h\" #include \"tle92466ed_spi_interface.hpp\" class Esp32SPIBus : public tle92466ed::SpiInterface { private: spi_device_handle_t spi_device_; gpio_num_t cs_pin_; public: Esp32SPIBus(spi_host_device_t host, const spi_device_interface_config_t& config, gpio_num_t cs) { spi_bus_add_device(host, &config, &spi_device_); cs_pin_ = cs; } auto spiTransfer(std::span txData, std::span rxData) noexcept -> std::expected override { // TLE92466ED uses 32-bit frames if (txData.size() { private: GPIO_TypeDef* cs_port_; uint16_t cs_pin_; public: STM32SPIBus(GPIO_TypeDef* cs_port, uint16_t cs_pin) : cs_port_(cs_port), cs_pin_(cs_pin) {} auto spiTransfer(std::span txData, std::span rxData) noexcept -> std::expected override { // Assert CS HAL_GPIO_WritePin(cs_port_, cs_pin_, GPIO_PIN_RESET); // Transfer 32-bit frame (4 bytes) HAL_StatusTypeDef status = HAL_SPI_TransmitReceive(&hspi1, const_cast(txData.data()), rxData.data(), 4, 100); // Deassert CS HAL_GPIO_WritePin(cs_port_, cs_pin_, GPIO_PIN_SET); if (status != HAL_OK) { return std::unexpected(tle92466ed::CommError::BusError); } return {}; } void delayMicroseconds(uint32_t us) noexcept override { // STM32 HAL delay (approximate) HAL_Delay((us + 999) / 1000); // Convert to milliseconds } }; ```cpp #### Arduino ```cpp #include #include \"tle92466ed_spi_interface.hpp\" class ArduinoSPIBus : public tle92466ed::SpiInterface { private: uint8_t cs_pin_; public: ArduinoSPIBus(uint8_t cs_pin) : cs_pin_(cs_pin) { pinMode(cs_pin_, OUTPUT); digitalWrite(cs_pin_, HIGH); SPI.begin(); SPI.beginTransaction(SPISettings(1000000, MSBFIRST, SPI_MODE1)); } auto spiTransfer(std::span txData, std::span rxData) noexcept -> std::expected override { digitalWrite(cs_pin_, LOW); // Transfer 32-bit frame (4 bytes) for (size_t i = 0; i std::expected override { switch (pin) { case tle92466ed::ControlPin::RESN: // Set RESN pin (active low) gpio_set_level(resn_pin_, level == tle92466ed::ActiveLevel::ACTIVE ? 0 : 1); break; case tle92466ed::ControlPin::EN: // Set EN pin (active high) gpio_set_level(en_pin_, level == tle92466ed::ActiveLevel::ACTIVE ? 1 : 0); break; default: return std::unexpected(tle92466ed::CommError::InvalidParameter); } return {}; } ```cpp ## Error Handling All methods return `std::expected`. Handle errors like this: ```cpp if (auto result = spi_interface.spiTransfer(tx, rx); !result) { // Handle error switch (result.error()) { case tle92466ed::CommError::BusError: // SPI bus error break; case tle92466ed::CommError::Timeout: // Operation timeout break; default: // Other errors break; } } ```cpp ## Testing Your Implementation 1. Create a simple test that transfers a known frame 2. Verify CRC calculation matches expected values 3. Test error conditions (timeout, bus error, etc.) 4. Verify timing requirements are met ## Next Steps - Review the [API Reference](/hf-tle92466ed-driver/development/docs/api_reference.html) for driver methods - Check [Examples](/hf-tle92466ed-driver/development/docs/examples.html) for complete usage examples - See [Troubleshooting](/hf-tle92466ed-driver/development/docs/troubleshooting.html) for common issues --- **Navigation** ‚¨ÖÔ∏è [Hardware Setup](/hf-tle92466ed-driver/development/docs/hardware_setup.html) | [Next: Configuration ‚û°Ô∏è](/hf-tle92466ed-driver/development/docs/configuration.html) | [Back to Index](/hf-tle92466ed-driver/development/docs/) ",
    "url": "/hf-tle92466ed-driver/development/docs/platform_integration.html",
    
    "relUrl": "/docs/platform_integration.html"
  },"7": {
    "doc": "Quick Start",
    "title": "Quick Start",
    "content": "# Quick Start This guide will get you up and running with the TLE92466ED driver in just a few steps. ## Prerequisites - [Driver installed](/hf-tle92466ed-driver/development/docs/installation.html) - [Hardware wired](/hf-tle92466ed-driver/development/docs/hardware_setup.html) - [SPI interface implemented](/hf-tle92466ed-driver/development/docs/platform_integration.html) ## Minimal Example Here's a complete working example: ```cpp #include \"tle92466ed.hpp\" // 1. Implement the SPI interface class MySpi : public tle92466ed::SpiInterface { public: auto spiTransfer(std::span txData, std::span rxData) noexcept -> std::expected override { // Your SPI transfer implementation // Assert CS, transfer 32-bit frames, deassert CS return {}; } void delayMicroseconds(uint32_t us) noexcept override { // Your delay implementation } }; // 2. Create instances MySpi spi; tle92466ed::Driver driver(spi); // 3. Initialize if (auto result = driver.Init(); !result) { // Handle error return; } // 4. Enter mission mode driver.EnterMissionMode(); // 5. Configure channel 0 for 1.5A current control driver.SetChannelMode(tle92466ed::Channel::CH0, tle92466ed::ChannelMode::ICC); driver.SetCurrentSetpoint(tle92466ed::Channel::CH0, 1500); // 1500 mA // 6. Enable channel driver.EnableChannel(tle92466ed::Channel::CH0, true); ```cpp ## Step-by-Step Explanation ### Step 1: Include the Header ```cpp #include \"tle92466ed.hpp\" ```cpp This includes the main driver class and all necessary types. ### Step 2: Implement the SPI Interface You need to implement the `SpiInterface` for your platform. See [Platform Integration](/hf-tle92466ed-driver/development/docs/platform_integration.html) for detailed examples. ```cpp class MySpi : public tle92466ed::SpiInterface { public: auto spiTransfer(std::span txData, std::span rxData) noexcept -> std::expected override { // Implement 32-bit SPI frame transfer with CRC return {}; } void delayMicroseconds(uint32_t us) noexcept override { // Implement microsecond delay } }; ```cpp ### Step 3: Create Driver Instance ```cpp MySpi spi; tle92466ed::Driver driver(spi); ```cpp The constructor takes a reference to your SPI interface implementation. ### Step 4: Initialize ```cpp if (auto result = driver.Init(); !result) { // Handle error - result.error() contains DriverError return; } ```cpp ### Step 5: Enter Mission Mode ```cpp driver.EnterMissionMode(); ```text Mission mode enables channel control. Configuration changes require Config Mode. ### Step 6: Configure Channel ```cpp driver.SetChannelMode(tle92466ed::Channel::CH0, tle92466ed::ChannelMode::ICC); driver.SetCurrentSetpoint(tle92466ed::Channel::CH0, 1500); // 1500 mA ```cpp ### Step 7: Enable Channel ```cpp driver.EnableChannel(tle92466ed::Channel::CH0, true); ```cpp ## Complete Example with Error Handling ```cpp #include \"tle92466ed.hpp\" class MySpi : public tle92466ed::SpiInterface { // ... SPI implementation }; void app_main() { MySpi spi; tle92466ed::Driver driver(spi); // Initialize if (auto result = driver.Init(); !result) { printf(\"Initialization failed: %d\\n\", static_cast(result.error())); return; } // Enter mission mode if (auto result = driver.EnterMissionMode(); !result) { printf(\"Failed to enter mission mode\\n\"); return; } // Configure channel 0 if (auto result = driver.SetChannelMode(tle92466ed::Channel::CH0, tle92466ed::ChannelMode::ICC); !result) { printf(\"Failed to set channel mode\\n\"); return; } if (auto result = driver.SetCurrentSetpoint(tle92466ed::Channel::CH0, 1500); !result) { printf(\"Failed to set current\\n\"); return; } // Enable channel driver.EnableChannel(tle92466ed::Channel::CH0, true); // Read diagnostics if (auto diag = driver.GetChannelDiagnostics(tle92466ed::Channel::CH0); diag) { printf(\"Channel 0 current: %u mA\\n\", diag->average_current); } } ```cpp ## Expected Output When running this example, you should see: ```cpp Channel 0 current: 1500 mA ```cpp ## Troubleshooting If you encounter issues: - **Compilation errors**: Check that you've implemented the `spiTransfer()` method in your SPI interface - **Initialization fails**: Verify SPI connections and hardware setup - **Channel not working**: Check channel configuration and enable state - **See**: [Troubleshooting](/hf-tle92466ed-driver/development/docs/troubleshooting.html) for common issues ## Next Steps - Explore [Examples](/hf-tle92466ed-driver/development/docs/examples.html) for more advanced usage - Review the [API Reference](/hf-tle92466ed-driver/development/docs/api_reference.html) for all available methods - Check [Configuration](/hf-tle92466ed-driver/development/docs/configuration.html) for customization options --- **Navigation** ‚¨ÖÔ∏è [Installation](/hf-tle92466ed-driver/development/docs/installation.html) | [Next: Hardware Setup ‚û°Ô∏è](/hf-tle92466ed-driver/development/docs/hardware_setup.html) | [Back to Index](/hf-tle92466ed-driver/development/docs/) ",
    "url": "/hf-tle92466ed-driver/development/docs/quickstart.html",
    
    "relUrl": "/docs/quickstart.html"
  },"8": {
    "doc": "Troubleshooting",
    "title": "Troubleshooting",
    "content": "# Troubleshooting This guide helps you diagnose and resolve common issues when using the TLE92466ED driver. ## Common Error Messages ### Error: Initialization Failed **Symptoms:** - `Init()` returns `DriverError::NotInitialized` or `DriverError::DeviceNotResponding` - Driver not responding to SPI **Causes:** - SPI interface not properly initialized - Hardware connections incorrect - Power supply issues - RESN pin held low **Solutions:** 1. **Verify SPI Interface**: Ensure SPI interface is initialized before creating driver 2. **Check Connections**: Verify all SPI connections (SCK, SI, SO, CSN) 3. **Verify Power**: Check power supply voltages (VBAT: 5.5V-41V, VIO: 3.0V-5.5V) 4. **Check RESN Pin**: Ensure RESN is released (HIGH) for SPI communication 5. **Verify SPI Mode**: Ensure SPI Mode 1 (CPOL=0, CPHA=1) 6. **Check SPI Speed**: Try lower SPI speed (e.g., 1 MHz) --- ### Error: Communication Error / CRC Error **Symptoms:** - `DriverError::CRCError` or `DriverError::SPIFrameError` returned - No response from device - CRC mismatches **Causes:** - SPI configuration incorrect - Signal integrity issues - CS timing problems - CRC calculation mismatch **Solutions:** 1. **Check SPI Mode**: Ensure SPI Mode 1 (CPOL=0, CPHA=1) 2. **Verify Speed**: Try lower SPI speed (e.g., 1 MHz, max 10 MHz) 3. **Check CS Timing**: Verify CS assertion/deassertion timing 4. **Verify Connections**: Check all SPI connections are secure 5. **Check CRC**: Verify CRC-8 (SAE J1850) calculation matches device 6. **Check Frame Format**: Ensure 32-bit frames are used --- ### Error: Channel Not Working **Symptoms:** - Channel enabled but no output - Current not flowing - No voltage on OUTx pin **Causes:** - Channel not properly configured - Channel not enabled - Load not connected correctly - Fault condition - Wrong mode (Config vs Mission) **Solutions:** 1. **Check Mode**: Ensure in Mission Mode (`EnterMissionMode()`) 2. **Check Configuration**: Verify channel configuration is correct 3. **Check Enable State**: Ensure channel is enabled via `EnableChannel()` 4. **Verify Load**: Check load connections (OUTx to load, load to VBAT) 5. **Check Faults**: Read fault status to identify issues 6. **Check Channel Mode**: Ensure channel mode is set (e.g., ICC mode) --- ### Error: Overcurrent Protection **Symptoms:** - `ChannelDiagnostics.overcurrent` is true - Channel disabled automatically - Current reading shows fault **Causes:** - Load current exceeds limits - Short circuit - Incorrect current settings - Parallel mode not configured correctly **Solutions:** 1. **Check Load**: Verify load is within specifications (2A max single, 4A parallel) 2. **Reduce Current**: Lower current setpoint 3. **Check for Shorts**: Verify no short circuits in wiring 4. **Clear Fault**: Read diagnostics to clear, then reconfigure 5. **Check Parallel Mode**: If using parallel, ensure `SetParallelOperation()` called --- ### Error: Open Load Detection **Symptoms:** - `ChannelDiagnostics.open_load` is true - No current flow - Load not detected **Causes:** - Load not connected - Broken connection - Load impedance too high - Open load threshold too sensitive **Solutions:** 1. **Check Connections**: Verify load is properly connected 2. **Check Wiring**: Inspect for broken wires 3. **Verify Load**: Ensure load impedance is appropriate 4. **Adjust Threshold**: Increase open load threshold if false positives --- ### Error: Wrong Mode **Symptoms:** - `DriverError::WrongMode` returned - Operation not allowed **Causes:** - Attempting channel control in Config Mode - Attempting configuration in Mission Mode - Mode transition not completed **Solutions:** 1. **Check Current Mode**: Use `IsMissionMode()` or `IsConfigMode()` 2. **Enter Correct Mode**: - For channel control: `EnterMissionMode()` - For configuration: `EnterConfigMode()` 3. **Wait for Transition**: Allow time for mode transition to complete --- ### Error: Invalid Parameter **Symptoms:** - `DriverError::InvalidParameter` returned - Invalid channel number - Parameter out of range **Causes:** - Channel number out of range (must be 0-5) - Current value out of range - Invalid configuration values **Solutions:** 1. **Check Channel Number**: Use `Channel::CH0` through `Channel::CH5` 2. **Check Current Range**: - Single mode: 0-2000 mA - Parallel mode: 0-4000 mA 3. **Verify Parameters**: Check all configuration values are within valid ranges --- ### Error: Device Not Responding **Symptoms:** - `DriverError::DeviceNotResponding` returned - No SPI response - Timeout errors **Causes:** - SPI bus not working - Device not powered - CS line issue - RESN pin held low **Solutions:** 1. **Check Power**: Verify VBAT and VIO are within range 2. **Check RESN**: Ensure RESN is HIGH (not in reset) 3. **Check CS**: Verify CS line is properly controlled 4. **Check SPI Bus**: Test SPI bus with simple read/write 5. **Check Connections**: Verify all SPI connections --- ### Error: Wrong Device ID **Symptoms:** - `DriverError::WrongDeviceID` returned - Device ID mismatch **Causes:** - Wrong device connected - Device not fully powered up - Communication error **Solutions:** 1. **Verify Device**: Check that TLE92466ED is connected 2. **Wait for Power-Up**: Allow time for device power-up 3. **Check Communication**: Verify SPI communication is working 4. **Read ID Manually**: Use `GetIcVersion()` to check device ID --- ## Debugging Tips ### Enable Logging ```cpp // Enable driver logging (if supported by your SPI interface) hal->SetLogLevel(tle92466ed::LogLevel::Debug); ```cpp ### Read Device Status ```cpp if (auto status = driver.GetDeviceStatus(); status) { printf(\"Config Mode: %d\\n\", status->config_mode); printf(\"Init Done: %d\\n\", status->init_done); printf(\"Any Fault: %d\\n\", status->any_fault); } ```cpp ### Read All Faults ```cpp if (auto faults = driver.GetAllFaults(); faults) { driver.PrintAllFaults(); // Prints formatted fault report } ```cpp ### Verify Device ```cpp if (auto verified = driver.VerifyDevice(); verified && *verified) { printf(\"Device verified\\n\"); } else { printf(\"Device verification failed\\n\"); } ```text ## Common Configuration Mistakes 1. **Forgetting to Enter Mission Mode**: Channels can only be enabled in Mission Mode 2. **Configuring in Wrong Mode**: Channel configuration requires Config Mode 3. **Not Setting Channel Mode**: Must set channel mode before setting current 4. **Parallel Mode Mismatch**: Forgetting to set `parallel_mode = true` when using parallel pairs 5. **Current Out of Range**: Setting current above 2000mA in single mode ## Next Steps - Review [Hardware Setup](/hf-tle92466ed-driver/development/docs/hardware_setup.html) for wiring verification - Check [Platform Integration](/hf-tle92466ed-driver/development/docs/platform_integration.html) for SPI interface issues - See [Examples](/hf-tle92466ed-driver/development/docs/examples.html) for working code samples --- **Navigation** ‚¨ÖÔ∏è [Examples](/hf-tle92466ed-driver/development/docs/examples.html) | [Back to Index](/hf-tle92466ed-driver/development/docs/) ",
    "url": "/hf-tle92466ed-driver/development/docs/troubleshooting.html",
    
    "relUrl": "/docs/troubleshooting.html"
  },"9": {
    "doc": "ESP32 Examples Configuration Guide",
    "title": "ESP32 Examples Configuration Guide",
    "content": "# ESP32 Examples Configuration Guide ## Overview This guide explains all configuration files and settings for the TLE92466ED ESP32 examples, including hardware configuration, build settings, and test options. ## üìÅ Configuration File Structure ```text examples/esp32/ ‚îú‚îÄ‚îÄ app_config.yml # Build metadata and app definitions ‚îú‚îÄ‚îÄ main/ ‚îÇ ‚îú‚îÄ‚îÄ TLE92466ED_TestConfig.hpp # Hardware configuration (SPI, pins, limits) ‚îÇ ‚îú‚îÄ‚îÄ DriverIntegrationTest.cpp # Driver integration test suite ‚îÇ ‚îú‚îÄ‚îÄ SolenoidControlTest.cpp # Real hardware solenoid control test ‚îÇ ‚îî‚îÄ‚îÄ Esp32TleCommInterface.cpp # ESP32 communication interface ‚îú‚îÄ‚îÄ sdkconfig # ESP-IDF SDK configuration ‚îî‚îÄ‚îÄ components/ ‚îî‚îÄ‚îÄ hf_tle92466ed/ ‚îú‚îÄ‚îÄ CMakeLists.txt # Component build config ‚îî‚îÄ‚îÄ idf_component.yml # Component metadata ``` --- ## 1. Hardware Configuration (`main/TLE92466ED_TestConfig.hpp`) ### Purpose **Centralized hardware-specific settings** for ESP32-C6 and TLE92466ED interface. ### Location ```text examples/esp32/main/TLE92466ED_TestConfig.hpp ``` ### Complete Configuration ```cpp #pragma once #include namespace TLE92466ED_TestConfig { //============================================================================= // SPI PIN CONFIGURATION //============================================================================= struct SPIPins { static constexpr int MISO = 2; // GPIO2 - SPI MISO static constexpr int MOSI = 7; // GPIO7 - SPI MOSI static constexpr int SCLK = 6; // GPIO6 - SPI Clock static constexpr int CS = 10; // GPIO10 - Chip Select }; //============================================================================= // SPI PARAMETERS //============================================================================= struct SPIParams { static constexpr int FREQUENCY = 1000000; // 1MHz SPI clock static constexpr int MODE = 0; // SPI Mode 0 (CPOL=0, CPHA=0) static constexpr int QUEUE_SIZE = 7; // Max transactions in queue }; //============================================================================= // CURRENT LIMITS //============================================================================= struct CurrentLimits { static constexpr uint16_t SINGLE_CHANNEL_MAX = 2000; // 2A per channel static constexpr uint16_t PARALLEL_CHANNEL_MAX = 4000; // 4A in parallel mode }; //============================================================================= // HARDWARE SPECIFICATIONS //============================================================================= struct HardwareSpecs { static constexpr float SUPPLY_VOLTAGE_MIN = 8.0f; // Minimum VBAT (V) static constexpr float SUPPLY_VOLTAGE_MAX = 28.0f; // Maximum VBAT (V) static constexpr int TEMPERATURE_MAX = 150; // Max junction temp (¬∞C) }; //============================================================================= // TEST CONFIGURATION //============================================================================= struct TestConfig { static constexpr uint16_t TEST_CURRENT_STEPS[] = {100, 500, 1000, 1500, 2000}; static constexpr size_t TEST_CURRENT_STEPS_COUNT = sizeof(TEST_CURRENT_STEPS) / sizeof(TEST_CURRENT_STEPS[0]); static constexpr uint32_t TEST_DURATION_MS = 5000; static constexpr uint32_t DIAGNOSTICS_POLL_INTERVAL_MS = 100; }; } // namespace TLE92466ED_TestConfig ```text ### Configuration Sections #### SPI Pins (`SPIPins`) | Setting | Default | Range | Notes |---------|---------|-------|-------| `MISO` | GPIO2 | Any GPIO | Data from TLE92466ED | `MOSI` | GPIO7 | Any GPIO | Data to TLE92466ED | `SCLK` | GPIO6 | Any GPIO | SPI clock output | `CS` | GPIO10 | Any GPIO | Chip select (active LOW) | **ESP32-C6 GPIO Considerations**: - Avoid GPIO0, GPIO8, GPIO9 (strapping pins) - GPIO12-GPIO13: JTAG (avoid if debugging) - GPIO15-GPIO20: USB Serial/JTAG - Recommended: GPIO2-GPIO11 for peripherals #### SPI Parameters (`SPIParams`) | Setting | Default | Range | Notes |---------|---------|-------|-------| `FREQUENCY` | 1000000 | 100000-10000000 | SPI clock (Hz, datasheet: 0.1-10MHz) | `MODE` | 1 | 0-3 | SPI mode (TLE92466ED requires Mode 1: CPOL=0, CPHA=1) | `QUEUE_SIZE` | 7 | 1-10 | Transaction queue depth | **SPI Mode 1** (per datasheet): - CPOL = 0 (clock idle LOW) - CPHA = 1 (sample on falling edge) - **Required by TLE92466ED** - do not change! **Frequency Guidelines**: - **100kHz**: Debug/troubleshooting - **1MHz**: Default, reliable (recommended) - **2-4MHz**: Higher performance - **8-10MHz**: Maximum (may require shorter cables, datasheet max: 10MHz) #### Current Limits (`CurrentLimits`) | Setting | Default | Range | Notes |---------|---------|-------|-------| `SINGLE_CHANNEL_MAX` | 2000 | 0-2000 | Max per channel (mA) | `PARALLEL_CHANNEL_MAX` | 4000 | 0-4000 | Parallel mode max (mA) | **Safety Notes**: - TLE92466ED maximum: 2A per channel - Parallel mode: 4A across paired channels - Driver enforces these limits - Exceeding causes overcurrent fault #### Hardware Specs (`HardwareSpecs`) | Setting | Default | Range | Notes |---------|---------|-------|-------| `SUPPLY_VOLTAGE_MIN` | 5.5 | 5.5-41.0 | Minimum VBAT (V) | `SUPPLY_VOLTAGE_MAX` | 41.0 | 5.5-41.0 | Maximum VBAT (V) | `TEMPERATURE_MAX` | 150 | -40 to 150 | Max junction temp (¬∞C) | **Operating Range** (per datasheet): - VBAT: 5.5V to 41V recommended operating (typical: 12V or 24V automotive) - VDD: 5V input to TLE92466ED (powers central logic) - Required for IC operation - VIO: 3.0V to 5.5V input (sets I/O voltage levels for SPI communication, typical: 3.3V or 5.0V) - Temperature: -40¬∞C to 150¬∞C junction #### Test Configuration (`TestConfig`) | Setting | Default | Notes |---------|---------|-------| `TEST_CURRENT_STEPS` | {100, 500, 1000, 1500, 2000} | Current test points (mA) | `TEST_DURATION_MS` | 5000 | Test duration (ms) | `DIAGNOSTICS_POLL_INTERVAL_MS` | 100 | Polling interval (ms) | **Used by test suites** for consistent test parameters. ### Modifying Hardware Configuration #### Example: Different GPIO Pins ```cpp struct SPIPins { static constexpr int MISO = 4; // Changed to GPIO4 static constexpr int MOSI = 5; // Changed to GPIO5 static constexpr int SCLK = 3; // Changed to GPIO3 static constexpr int CS = 11; // Changed to GPIO11 }; ```text #### Example: Higher SPI Frequency ```cpp struct SPIParams { static constexpr int FREQUENCY = 4000000; // 4MHz (higher performance) static constexpr int MODE = 0; static constexpr int QUEUE_SIZE = 7; }; ```text #### Example: Custom Test Currents ```cpp struct TestConfig { static constexpr uint16_t TEST_CURRENT_STEPS[] = {250, 750, 1250, 1750}; static constexpr size_t TEST_CURRENT_STEPS_COUNT = 4; static constexpr uint32_t TEST_DURATION_MS = 10000; // 10 seconds static constexpr uint32_t DIAGNOSTICS_POLL_INTERVAL_MS = 50; // 50ms }; ```text --- ## 2. Application Configuration (`app_config.yml`) ### Purpose **Build metadata and app definitions** for the dynamic build system. ### Location ```text examples/esp32/app_config.yml ```text ### Structure ```yaml apps: driver_integration_test: description: \"Comprehensive driver integration test suite (no hardware required)\" source_file: \"DriverIntegrationTest.cpp\" category: \"test\" idf_versions: [\"release/v5.5\"] build_types: [\"Debug\", \"Release\"] ci_enabled: true featured: true documentation: \"docs/readme_driver_integration_test.md\" ``` ### App Definition Fields | Field | Type | Required | Description |-------|------|----------|-------------| `description` | string | Yes | Human-readable description | `source_file` | string | Yes | Main source file in `main/` | `category` | string | Yes | Category: `demo`, `test`, `application` | `idf_versions` | list | Yes | Compatible ESP-IDF versions | `build_types` | list | Yes | Supported build types | `ci_enabled` | bool | Yes | Enable in CI/CD pipeline | `featured` | bool | No | Feature in documentation | `documentation` | string | No | Path to documentation file | ### Build Types #### Debug ```yaml build_types: [\"Debug\"] ```text - **Optimization**: `-Og` (debug-friendly) - **Symbols**: Full debug symbols - **Assertions**: Enabled - **Size**: Larger binaries - **Speed**: Slower execution - **Use**: Development, debugging #### Release ```yaml build_types: [\"Release\"] ```text - **Optimization**: `-O2` (performance) - **Symbols**: Minimal symbols - **Assertions**: Disabled - **Size**: Smaller binaries - **Speed**: Faster execution - **Use**: Production, benchmarking ### IDF Versions ```yaml idf_versions: - \"release/v5.5\" # ESP-IDF v5.5.x (recommended) - \"release/v5.4\" # ESP-IDF v5.4.x (compatible) - \"release/v5.3\" # ESP-IDF v5.3.x (minimum) ```text **Requirements**: - **Minimum**: ESP-IDF v5.3 (C++23 support) - **Recommended**: ESP-IDF v5.5 (latest features) ### Adding a New App ```yaml apps: my_custom_app: description: \"My custom TLE92466ED application\" source_file: \"MyCustomApp.cpp\" category: \"application\" idf_versions: [\"release/v5.5\"] build_types: [\"Debug\", \"Release\"] ci_enabled: false featured: false documentation: \"docs/README_MY_CUSTOM_APP.md\" ```text Then create: ```text examples/esp32/main/MyCustomApp.cpp examples/esp32/docs/README_MY_CUSTOM_APP.md ```text --- ## 3. Test Section Configuration ### Purpose **Compile-time enable/disable** of test sections. ### Location In each example source file (e.g., `DriverIntegrationTest.cpp`): ```cpp //============================================================================= // TEST CONFIGURATION //============================================================================= #define ENABLE_INITIALIZATION_TESTS 1 #define ENABLE_BASIC_OPERATION_TESTS 1 #define ENABLE_CURRENT_CONTROL_TESTS 1 ```text ### Test Sections | Section | Purpose | Tests |---------|---------|-------| `INITIALIZATION_TESTS` | HAL and driver setup | HAL init, driver init, chip ID | `BASIC_OPERATION_TESTS` | Core operations | Enable/disable, current setting, diagnostics | `CURRENT_CONTROL_TESTS` | Advanced control | Current ramping, multi-channel | ### Disabling Sections Set to `0` to disable: ```cpp #define ENABLE_INITIALIZATION_TESTS 1 // Enabled #define ENABLE_BASIC_OPERATION_TESTS 1 // Enabled #define ENABLE_CURRENT_CONTROL_TESTS 0 // DISABLED ```text **Benefits**: - Faster iteration during development - Focus on specific features - Reduce test time - Save memory if needed ### Usage in Code ```cpp RUN_TEST_SECTION_IF_ENABLED( ENABLE_INITIALIZATION_TESTS, \"INITIALIZATION TESTS\", // Tests only run if flag is 1 RUN_TEST_IN_TASK(\"hal_init\", test_hal_initialization, 8192, 5); ); ```text --- ## 4. ESP-IDF SDK Configuration (`sdkconfig`) ### Purpose **ESP-IDF framework configuration** - compiler, components, features. ### Location ```text examples/esp32/sdkconfig ```text ### Key Settings #### Compiler Optimization ```ini CONFIG_COMPILER_OPTIMIZATION_SIZE=n CONFIG_COMPILER_OPTIMIZATION_PERF=y CONFIG_COMPILER_OPTIMIZATION_DEBUG=n ```text **Options**: - `SIZE`: Optimize for size (`-Os`) - `PERF`: Optimize for performance (`-O2`) **‚Üê Default** - `DEBUG`: Optimize for debugging (`-Og`) #### C++ Standard ```ini CONFIG_COMPILER_CXX_STD_GNUXX23=y ```text **Required**: TLE92466ED driver uses C++23 features (`std::expected`) #### Log Level ```ini CONFIG_LOG_DEFAULT_LEVEL_INFO=y CONFIG_LOG_DEFAULT_LEVEL_DEBUG=n ```text **Options**: - `NONE`: No logging - `ERROR`: Errors only - `WARN`: Warnings and errors - `INFO`: Information, warnings, errors **‚Üê Default** - `DEBUG`: Debug + all above - `VERBOSE`: Verbose + all above #### Stack Sizes ```ini CONFIG_ESP_MAIN_TASK_STACK_SIZE=8192 CONFIG_ESP_SYSTEM_EVENT_TASK_STACK_SIZE=4096 ```text **Recommendations**: - Main task: 8KB (default sufficient) - Increase if stack overflow errors occur #### FreeRTOS ```ini CONFIG_FREERTOS_HZ=1000 CONFIG_FREERTOS_USE_TRACE_FACILITY=y CONFIG_FREERTOS_GENERATE_RUN_TIME_STATS=y ```text **Important**: - `HZ=1000`: 1ms tick resolution (for accurate timing) - Trace facility: Useful for debugging ### Modifying sdkconfig #### Via menuconfig (Interactive) ```bash cd examples/esp32 idf.py menuconfig ```text Navigate with arrow keys, space to select, 'S' to save. #### Via sdkconfig.defaults Create `sdkconfig.defaults`: ```ini # Custom defaults CONFIG_COMPILER_OPTIMIZATION_PERF=y CONFIG_LOG_DEFAULT_LEVEL_DEBUG=y CONFIG_ESP_MAIN_TASK_STACK_SIZE=16384 ```text Then: ```bash idf.py fullclean idf.py reconfigure ```text --- ## 5. Component Configuration ### Component CMakeLists.txt **Location**: `examples/esp32/components/hf_tle92466ed/CMakeLists.txt` ```cmake # Source resolution (automatic) if(EXISTS \"${PROJECT_ROOT}/src\" AND EXISTS \"${PROJECT_ROOT}/include\") set(SRC_ROOT \"${PROJECT_ROOT}\") # CI environment else() get_filename_component(SRC_ROOT \"${CMAKE_SOURCE_DIR}/../../\" ABSOLUTE) endif() # Source files set(TLE92466ED_SRCS \"${SRC_ROOT}/src/tle92466ed.cpp\" ) # Component registration idf_component_register( SRCS ${EXISTING_SRCS} INCLUDE_DIRS \"${SRC_ROOT}/include\" REQUIRES driver esp_timer freertos esp_driver_spi ) # C++23 standard target_compile_features(${COMPONENT_LIB} PRIVATE cxx_std_23) ```text **Key Points**: - Automatically finds driver sources - Handles CI and development paths - C++23 required - No manual source list maintenance ### Component Manifest (idf_component.yml) **Location**: `examples/esp32/components/hf_tle92466ed/idf_component.yml` ```yaml name: hf-tle92466ed-driver version: \"2.0.0\" description: TLE92466ED driver for ESP-IDF dependencies: idf: \">=5.0.0\" targets: - esp32c6 - esp32 - esp32s3 - esp32c3 ``` **Purpose**: ESP-IDF Component Manager metadata --- ## üîß Configuration Workflows ### Development Setup 1. **Clone repository** ```bash git clone https://github.com/N3b3x/hf-tle92466ed-driver.git cd hf-tle92466ed-driver/examples/esp32 ``` 2. **Initialize submodules** ```bash git submodule update --init --recursive ``` 3. **Configure hardware** (if needed) ```bash nano main/TLE92466ED_TestConfig.hpp # Modify SPI pins, frequency, etc. ``` 4. **Set ESP-IDF target** ```bash idf.py set-target esp32c6 ``` 5. **Configure SDK** (optional) ```bash idf.py menuconfig ``` 6. **Build** ```bash ./scripts/build_app.sh basic_usage Debug ``` ### Production Setup 1. **Use Release build** ```bash ./scripts/build_app.sh basic_usage Release ``` 2. **Optimize sdkconfig** ```ini CONFIG_COMPILER_OPTIMIZATION_PERF=y CONFIG_LOG_DEFAULT_LEVEL_WARN=y CONFIG_BOOTLOADER_LOG_LEVEL_WARN=y ``` 3. **Disable debug features** ```cpp #define ENABLE_DEBUG_LOGGING 0 #define ENABLE_STRESS_TESTS 0 ``` 4. **Verify settings** ```bash idf.py size idf.py size-components ``` ### Troubleshooting Configuration #### GPIO Conflict **Error**: `GPIO already in use` **Solution**: Change pins in `TLE92466ED_TestConfig.hpp`: ```cpp struct SPIPins { static constexpr int MISO = 4; // Try different GPIO // ... }; ``` #### SPI Communication Failure **Error**: `Failed to initialize HAL` **Solutions**: 1. Check frequency: Lower to 100kHz for testing 2. Verify wiring matches configuration 3. Try different SPI host (SPI2_HOST vs SPI3_HOST) #### Stack Overflow **Error**: `***ERROR*** A stack overflow in task` **Solutions**: 1. Increase task stack in `RUN_TEST_IN_TASK`: ```cpp RUN_TEST_IN_TASK(\"test\", test_func, 16384, 5); // 16KB ``` 2. Increase main stack in sdkconfig: ```ini CONFIG_ESP_MAIN_TASK_STACK_SIZE=16384 ``` #### Build Type Issues **Error**: Unexpected optimization level **Solution**: ```bash # Clean and rebuild with explicit build type idf.py fullclean idf.py -DCMAKE_BUILD_TYPE=Debug build ``` --- ## üìö Configuration Reference ### File Purposes Summary | File | Purpose | When to Modify |------|---------|----------------| `TLE92466ED_TestConfig.hpp` | Hardware settings | Different GPIO/hardware | `app_config.yml` | Build metadata | Add new app/example | `DriverIntegrationTest.cpp` (flags) | Test sections | Enable/disable tests | `sdkconfig` | ESP-IDF settings | Compiler/framework config | `components/.../CMakeLists.txt` | Component build | Never (auto-configured) | `components/.../idf_component.yml` | Component metadata | Version/dependency changes | ### Configuration Hierarchy ```text Hardware Layer ‚îî‚îÄ‚îÄ TLE92466ED_TestConfig.hpp (SPI pins, frequencies, limits) Application Layer ‚îú‚îÄ‚îÄ app_config.yml (Build metadata, app list) ‚îî‚îÄ‚îÄ *Example.cpp (Test section flags) Framework Layer ‚îú‚îÄ‚îÄ sdkconfig (ESP-IDF configuration) ‚îî‚îÄ‚îÄ components/ (Component configuration) ```text --- **Document Version**: 1.0.0 **Last Updated**: 2025-10-21 **Status**: ‚úÖ Complete ",
    "url": "/hf-tle92466ed-driver/development/examples/esp32/docs/README_CONFIGURATION.html",
    
    "relUrl": "/examples/esp32/docs/README_CONFIGURATION.html"
  },"10": {
    "doc": "Driver Integration Test Suite - TLE92466ED ESP32-C6",
    "title": "Driver Integration Test Suite - TLE92466ED ESP32-C6",
    "content": "# Driver Integration Test Suite - TLE92466ED ESP32-C6 ## Table of Contents 1. [Overview](#overview) 2. [Purpose](#purpose) 3. [Test Framework Architecture](#test-framework-architecture) 4. [Test Suite Structure](#test-suite-structure) 5. [Hardware Setup](#hardware-setup) 6. [Configuration](#configuration) 7. [Building and Running](#building-and-running) 8. [Expected Output](#expected-output) 9. [Test Coverage](#test-coverage) 10. [Individual Test Details](#individual-test-details) 11. [Troubleshooting](#troubleshooting) 12. [Performance Characteristics](#performance-characteristics) 13. [Related Documentation](#related-documentation) --- ## Overview The **Driver Integration Test Suite** validates all functionality of the TLE92466ED driver without requiring actual solenoids or loads. This test suite provides API validation with **40+ individual tests** organized into **13 test sections**, covering all driver capabilities. ### Key Features - **Complete API Coverage**: Tests all public driver functions - **No Hardware Required**: Validates driver logic and SPI communication only - **Test Framework**: FreeRTOS task-based execution with automatic result tracking - **GPIO14 Progress Indicator**: Visual feedback on oscilloscope/logic analyzer - **Telemetry Testing**: Validates all status and diagnostic reading functions - **Error Condition Testing**: Verifies proper error handling and validation --- ## Purpose This test suite serves multiple purposes: 1. **Driver Validation**: Ensures all driver APIs work correctly 2. **Regression Testing**: Detects breaking changes during development 3. **CI/CD Integration**: Automated testing in continuous integration pipelines 4. **Documentation**: Demonstrates proper usage of all driver functions 5. **Development Aid**: Helps developers understand driver capabilities 6. **Quality Assurance**: Validates driver behavior before hardware testing **Note**: This test validates the driver and SPI communication but does not test actual solenoid operation. For real hardware testing with solenoids, use the **Solenoid Control Test**. --- ## Test Framework Architecture The test suite uses the **TLE92466ED Test Framework** (`TLE92466ED_TestFramework.hpp`), which provides: #### FreeRTOS Task-Based Execution - Each test runs in isolated FreeRTOS task - Custom stack size per test (8KB default) - Automatic semaphore synchronization - 30-second timeout protection - Fallback to inline execution on failure #### GPIO14 Progress Indicator - Visual feedback on oscilloscope/logic analyzer - **Toggle**: HIGH/LOW on each test completion - **Blink Pattern**: 5 blinks at section start/end - Hardware-level test progression tracking #### Automatic Result Tracking - Pass/fail counting - Microsecond-precision execution timing - Success rate calculation - Summary reports #### Test Section Management - Compile-time section enable/disable - Section-based organization - Custom blink patterns per section - Structured output formatting --- ## Test Suite Structure This integration test suite validates all functionality of the TLE92466ED driver. The suite includes **13 test sections** with **40+ individual tests** covering all driver APIs. ### Test Sections #### 1. INITIALIZATION_TESTS (`#define ENABLE_INITIALIZATION_TESTS 1`) Tests fundamental setup and communication: - `test_hal_initialization` - ESP32-C6 HAL setup and SPI configuration - `test_driver_initialization` - TLE92466ED driver instance creation - `test_chip_id` - SPI communication verification via chip ID - `test_ic_version` - IC version register reading - `test_device_verification` - Device ID verification #### 2. MODE_CONTROL_TESTS (`#define ENABLE_MODE_CONTROL_TESTS 1`) Tests mode transitions and state management: - `test_enter_mission_mode` - Transition to Mission Mode - `test_enter_config_mode` - Transition to Config Mode - `test_mode_transitions` - Multiple mode transition cycles #### 3. GLOBAL_CONFIGURATION_TESTS (`#define ENABLE_GLOBAL_CONFIG_TESTS 1`) Tests global device configuration: - `test_crc_control` - CRC enable/disable functionality - `test_vbat_thresholds` - VBAT UV/OV threshold configuration (high-level and raw APIs) - `test_global_configuration` - Complete global configuration #### 4. CHANNEL_CONTROL_TESTS (`#define ENABLE_CHANNEL_CONTROL_TESTS 1`) Tests channel enable/disable and mode configuration: - `test_single_channel_control` - Single channel enable/disable - `test_all_channels_control` - All channels enable/disable - `test_channel_mask_control` - Channel mask-based control - `test_channel_mode_configuration` - All channel modes (OFF, ICC, Direct Drive, etc.) #### 5. CURRENT_CONTROL_TESTS (`#define ENABLE_CURRENT_CONTROL_TESTS 1`) Tests current setpoint control: - `test_current_setpoint` - Current setting with read-back verification (100mA, 500mA, 1000mA, 1500mA, 2000mA) - `test_current_ramping` - Smooth 0‚Üí1000mA‚Üí0mA transitions #### 6. PWM_CONFIGURATION_TESTS (`#define ENABLE_PWM_CONFIG_TESTS 1`) Tests PWM period configuration: - `test_pwm_period_configuration` - High-level API (period in microseconds) - `test_pwm_period_raw` - Low-level API (mantissa, exponent, low_freq_range) #### 7. DITHER_CONFIGURATION_TESTS (`#define ENABLE_DITHER_CONFIG_TESTS 1`) Tests dither configuration: - `test_dither_configuration` - High-level API (amplitude in mA, frequency in Hz) - `test_dither_raw` - Low-level API (step_size, num_steps, flat_steps) #### 8. DIAGNOSTICS_TESTS (`#define ENABLE_DIAGNOSTICS_TESTS 1`) Tests diagnostics and monitoring: - `test_device_status` - Global device status reading - `test_channel_diagnostics` - Channel-specific diagnostics - `test_voltage_reading` - VBAT and VIO voltage reading - `test_current_reading` - Average current and duty cycle reading - `test_all_channels_telemetry` - Telemetry for all 6 channels - `test_device_telemetry` - Device telemetry - `test_telemetry_with_active_channel` - Telemetry with active channel #### 9. FAULT_MANAGEMENT_TESTS (`#define ENABLE_FAULT_MANAGEMENT_TESTS 1`) Tests fault handling: - `test_fault_clearing` - Fault flag clearing - `test_software_reset` - Software reset functionality #### 10. WATCHDOG_TESTS (`#define ENABLE_WATCHDOG_TESTS 1`) Tests watchdog functionality: - `test_spi_watchdog` - SPI watchdog reload with various values #### 11. GPIO_CONTROL_TESTS (`#define ENABLE_GPIO_CONTROL_TESTS 1`) Tests GPIO pin control: - `test_gpio_control` - Reset, Enable, and Fault pin control #### 12. MULTI_CHANNEL_TESTS (`#define ENABLE_MULTI_CHANNEL_TESTS 1`) Tests all channels individually: - `test_all_channels_individually` - All 6 channels tested with enable/disable and current control #### 13. PARALLEL_OPERATION_TESTS (`#define ENABLE_PARALLEL_OPERATION_TESTS 1`) Tests parallel channel operation: - `test_parallel_operation` - Parallel pair configuration (CH0/CH3, CH1/CH2, CH4/CH5) #### 14. ERROR_CONDITION_TESTS (`#define ENABLE_ERROR_CONDITION_TESTS 1`) Tests error handling and validation: - `test_error_conditions` - Wrong mode operations (should fail correctly) ### Test Function Signatures All test functions follow this pattern: ```cpp static bool test_function_name() noexcept; ``` **Key Characteristics**: - Return `bool` (true = passed, false = failed) - Declared `noexcept` for embedded safety - Self-contained and isolated - Descriptive ESP_LOG output - Proper error handling with `std::expected` --- ## Hardware Setup ### Required Components - **ESP32-C6-DevKitC-1** development board - **TLE92466ED** evaluation board or custom PCB - **5.5-41V power supply** for VBAT (2A minimum) - *Note: VBAT not required for SPI communication, but recommended for complete testing. Typical: 12V or 24V automotive* - **3.0-5.5V power supply** for VIO (I/O level supply) - *Required for SPI communication (sets I/O voltage levels). Typical: 3.3V or 5.0V* - **5V power supply** for VDD (internal logic supply) - *Required for IC operation* - **Oscilloscope/Logic Analyzer** (optional, for GPIO14 monitoring) - Connecting wires ### Wiring Diagram ``` ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ESP32-C6 ‚îÇ ‚îÇ TLE92466ED ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ GPIO2 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ MISO ‚îÇ ‚îÇ GPIO7 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ MOSI ‚îÇ ‚îÇ GPIO6 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ SCLK ‚îÇ ‚îÇ GPIO18 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ CS ‚îÇ ‚îÇ GPIO21 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ RESN ‚îÇ ‚îÇ GPIO20 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ EN ‚îÇ ‚îÇ GPIO19 ‚îÇ [LED/Scope] ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ 5V ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ VDD ‚îÇ ‚îÇ 3.3V ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ VIO ‚îÇ ‚îÇ GND ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ GND ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ External Supply Test Load ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 12-24V ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> VBAT OUT0 ‚îÄ‚îÄ> Load GND ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> GND GND ‚îÄ‚îÄ> Return ``` ### Complete Pin Configuration | Function | ESP32-C6 GPIO | TLE92466ED Pin | Configuration | Notes |----------|---------------|----------------|---------------|-------| **SPI MISO** | GPIO2 | MISO | Input | Data from TLE92466ED | **SPI MOSI** | GPIO7 | MOSI | Output | Data to TLE92466ED | **SPI SCLK** | GPIO6 | SCLK | Output | 1MHz SPI Clock | **SPI CS** | GPIO18 | CS | Output | Active Low | **RESN** | GPIO21 | RESN | Output | Reset pin (active low) | **EN** | GPIO20 | EN | Output | Enable pin (active high) | **FAULTN** | GPIO19 | FAULTN | Input | Fault pin (active low) | **Test Indicator** | GPIO14 | - | Output | Progress indicator | **VDD Supply** | 5V | VDD | Power | 5V (Required for IC operation) | **VIO Supply** | 3.3V/5V | VIO | Power | 3.0-5.5V (Required for SPI) | **Load Supply** | External | VBAT | Power | 5.5-41V, 2A+ (Optional for SPI) | **Ground** | GND | GND | Ground | Common reference | ### GPIO14 Test Indicator Setup ``` ESP32-C6 GPIO14 ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ LED (Anode) ‚îÇ ‚îî‚îÄ‚îÄ LED (Cathode) ‚îÄ‚îÄ 220Œ© ‚îÄ‚îÄ GND ‚îÇ ‚îî‚îÄ‚îÄ Oscilloscope/Logic Analyzer Probe ``` **Purpose**: Visual and measurable feedback showing test progression ### Power Supply Requirements ``` ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Power Supply Requirements ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îÇ ‚îÇ VDD (Internal Logic Supply): ‚îÇ ‚îÇ ‚îî‚îÄ 5V input to TLE92466ED ‚îÇ ‚îÇ ‚îî‚îÄ Powers central logic of the IC ‚îÇ ‚îÇ ‚îî‚îÄ Required for IC operation ‚îÇ ‚îÇ ‚îÇ ‚îÇ VIO (I/O Level Supply): ‚îÇ ‚îÇ ‚îî‚îÄ 3.0V to 5.5V (input) ‚îÇ ‚îÇ ‚îî‚îÄ Sets I/O voltage levels for SPI ‚îÇ ‚îÇ ‚îî‚îÄ Required for SPI communication ‚îÇ ‚îÇ ‚îî‚îÄ Typical: 3.3V or 5.0V ‚îÇ ‚îÇ ‚îî‚îÄ Typical current: 10-20mA ‚îÇ ‚îÇ ‚îÇ ‚îÇ VBAT (Load Supply): ‚îÇ ‚îÇ ‚îî‚îÄ 5.5V to 41V (recommended operating) ‚îÇ ‚îÇ ‚îî‚îÄ Typical: 12V or 24V automotive ‚îÇ ‚îÇ ‚îî‚îÄ NOT required for SPI communication ‚îÇ ‚îÇ ‚îî‚îÄ Required for actual load operation ‚îÇ ‚îÇ ‚îî‚îÄ Typical: 2A+ per channel ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ``` **Important**: For this driver integration test, **VBAT is not required**. The test validates SPI communication and driver logic only. **VDD is required** (powers central logic). **VIO is required for SPI communication** (sets I/O voltage levels). --- ## Configuration ### Hardware Configuration (`main/TLE92466ED_TestConfig.hpp`) All hardware-specific settings are centralized: ```cpp namespace TLE92466ED_TestConfig { struct SPIPins { static constexpr uint8_t MISO = 2; // GPIO2 static constexpr uint8_t MOSI = 7; // GPIO7 static constexpr uint8_t SCLK = 6; // GPIO6 static constexpr uint8_t CS = 18; // GPIO18 }; struct ControlPins { static constexpr uint8_t RESN = 21; // GPIO21 static constexpr uint8_t EN = 20; // GPIO20 static constexpr uint8_t FAULTN = 19; // GPIO19 static constexpr uint8_t DRV0 = 22; // GPIO22 static constexpr uint8_t DRV1 = 23; // GPIO23 }; struct SPIParams { static constexpr uint32_t FREQUENCY = 1000000; // 1MHz static constexpr uint8_t MODE = 1; // SPI Mode 1 (CPOL=0, CPHA=1) static constexpr uint8_t QUEUE_SIZE = 1; static constexpr uint8_t CS_ENA_PRETRANS = 1; static constexpr uint8_t CS_ENA_POSTTRANS = 1; }; } // namespace TLE92466ED_TestConfig ``` **To modify hardware settings**: Edit `main/TLE92466ED_TestConfig.hpp` ### Test Configuration (`main/DriverIntegrationTest.cpp`) Enable/disable test sections at compile time: ```cpp // Enable/disable test sections (set to 0 to skip a section) #define ENABLE_INITIALIZATION_TESTS 1 #define ENABLE_MODE_CONTROL_TESTS 1 #define ENABLE_GLOBAL_CONFIG_TESTS 1 #define ENABLE_CHANNEL_CONTROL_TESTS 1 #define ENABLE_CURRENT_CONTROL_TESTS 1 #define ENABLE_PWM_CONFIG_TESTS 1 #define ENABLE_DITHER_CONFIG_TESTS 1 #define ENABLE_DIAGNOSTICS_TESTS 1 #define ENABLE_FAULT_MANAGEMENT_TESTS 1 #define ENABLE_WATCHDOG_TESTS 1 #define ENABLE_GPIO_CONTROL_TESTS 1 #define ENABLE_MULTI_CHANNEL_TESTS 1 #define ENABLE_PARALLEL_OPERATION_TESTS 1 #define ENABLE_ERROR_CONDITION_TESTS 1 ``` **To disable a section**: Set to `0` and rebuild. This allows you to run only specific test categories during development or debugging. ### Build Configuration (`app_config.yml`) Application metadata and build settings: ```yaml apps: driver_integration_test: description: \"Comprehensive driver integration test suite (no hardware required)\" source_file: \"DriverIntegrationTest.cpp\" category: \"test\" idf_versions: [\"release/v5.5\"] build_types: [\"Debug\", \"Release\"] ci_enabled: true featured: true ``` **Note**: This is for build metadata only. Hardware config is in `TLE92466ED_TestConfig.hpp`. --- ## Building and Running ### Quick Start ```bash cd examples/esp32 # Build the driver integration test ./scripts/build_app.sh driver_integration_test Debug # Flash to ESP32-C6 ./scripts/flash_app.sh driver_integration_test Debug # Monitor output ./scripts/monitor_app.sh driver_integration_test ``` ### Manual Build ```bash cd examples/esp32 # Set target idf.py set-target esp32c6 # Configure (optional) idf.py menuconfig # Build with APP_TYPE=driver_integration_test idf.py -DAPP_TYPE=driver_integration_test build # Flash idf.py -p /dev/ttyUSB0 flash # Monitor idf.py -p /dev/ttyUSB0 monitor ``` ### Build Targets ```bash # Debug build (optimized for debugging) idf.py -DAPP_TYPE=driver_integration_test -DCMAKE_BUILD_TYPE=Debug build # Release build (optimized for performance) idf.py -DAPP_TYPE=driver_integration_test -DCMAKE_BUILD_TYPE=Release build ``` --- ## Expected Output ### Test Header ``` ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë TLE92466ED DRIVER INTEGRATION TEST SUITE - ESP32-C6 ‚ïë ‚ïë HardFOC Core Drivers ‚ïë ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù Target: esp32c6 ESP-IDF Version: v5.5.1 ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë TLE92466ED TEST CONFIGURATION ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ ‚ïë Test sections will execute based on compile-time configuration ‚ïë ‚ïë GPIO14 test progression indicator: ENABLED ‚ïë ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ``` ### Test Execution ``` ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë SECTION: INITIALIZATION TESTS ‚ïë ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù [GPIO14: Blink pattern - 5 blinks] ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë Running (task): hal_initialization ‚ïë ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù I (1234) TLE92466ED_Test: Creating HAL instance... I (1235) Esp32TleComm: Esp32TleCommInterface created with SPI config I (1236) Esp32TleComm: MISO: GPIO2, MOSI: GPIO7, SCLK: GPIO6, CS: GPIO18 I (1237) Esp32TleComm: Frequency: 1000000 Hz, Mode: 1 I (1238) TLE92466ED_Test: Initializing HAL... I (1240) Esp32TleComm: Esp32TleCommInterface initialized successfully I (1241) TLE92466ED_Test: ‚úÖ HAL initialized successfully [SUCCESS] PASSED (task): hal_initialization (12.34 ms) Test task completed: hal_initialization [GPIO14: Toggle HIGH] ``` ### Test Results Summary ``` ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë TEST RESULTS SUMMARY ‚ïë ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ ‚ïë Total Tests: 40+ ‚ïë ‚ïë Passed: 40+ ‚ïë ‚ïë Failed: 0 ‚ïë ‚ïë Success Rate: 100.00% ‚ïë ‚ïë Total Time: ~10-15 seconds ‚ïë ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù I (15000) TLE92466ED_Test: ‚úÖ ALL TESTS PASSED! System will restart in 10 seconds... ``` ### GPIO14 Signal Pattern ``` Time ‚îÇ GPIO14 ‚îÇ Event ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ 0ms ‚îÇ LOW ‚îÇ Boot 100ms ‚îÇ BLINK ‚îÇ Section start (5 blinks) ‚îÇ ‚Üë‚Üì ‚îÇ 200ms ‚îÇ HIGH ‚îÇ Test 1 complete 300ms ‚îÇ LOW ‚îÇ Test 2 complete 400ms ‚îÇ HIGH ‚îÇ Test 3 complete 500ms ‚îÇ BLINK ‚îÇ Section 2 start (5 blinks) 600ms ‚îÇ LOW ‚îÇ Test 4 complete ... ``` --- ## Test Coverage ### Complete API Coverage This test suite covers all TLE92466ED driver functionality: #### Initialization & Device Information - HAL initialization - Driver initialization - Chip ID reading - IC version reading - Device verification #### Mode Management - Mission Mode entry/exit - Config Mode entry/exit - Mode transition validation #### Global Configuration - CRC enable/disable - VBAT threshold configuration (high-level and raw) - Complete global configuration #### Channel Control - Single channel enable/disable - All channels control - Channel mask control - Channel mode configuration (all modes) #### Current Control - Current setpoint setting (with read-back) - Current ramping (smooth transitions) #### PWM Configuration - High-level API (period in microseconds) - Low-level API (mantissa, exponent, low_freq_range) #### Dither Configuration - High-level API (amplitude in mA, frequency in Hz) - Low-level API (step_size, num_steps, flat_steps) #### Diagnostics & Monitoring - Device status reading - Channel diagnostics - Voltage reading (VBAT, VIO) - Current and duty cycle reading - **Telemetry for all channels** - **Device-level telemetry** - **Telemetry with active channels** #### Fault Management - Fault clearing - Software reset #### Watchdog - SPI watchdog reload #### GPIO Control - Reset pin control - Enable pin control - Fault pin reading #### Multi-Channel Operations - All 6 channels individually tested #### Parallel Operation - Parallel pair configuration #### Error Handling - Wrong mode operation validation - Error condition testing --- ## Individual Test Details ### Initialization Tests #### `test_hal_initialization()` **Purpose**: Validate ESP32-C6 HAL creation and SPI initialization **Operations**: 1. Create Esp32TleCommInterface instance with configuration from `TLE92466ED_TestConfig.hpp` 2. Initialize SPI peripheral (SPI2_HOST) 3. Configure GPIO pins for SPI 4. Set up SPI parameters (1MHz, Mode 1) **Expected Result**: ‚úÖ PASS - HAL instance created successfully - SPI bus initialized - GPIO pins configured - Ready for communication **Failure Modes**: - SPI bus already initialized - GPIO pins in use - Invalid SPI configuration - Hardware fault --- #### `test_driver_initialization()` **Purpose**: Create TLE92466ED driver instance and initialize IC **Operations**: 1. Create TLE92466ED driver instance with HAL reference 2. Execute driver initialization sequence 3. Configure TLE92466ED registers 4. Set up default parameters **Expected Result**: ‚úÖ PASS - Driver instance created - IC initialized successfully - Registers configured - Ready for operations **Failure Modes**: - HAL not initialized - SPI communication failure - TLE92466ED not powered (VIO required for SPI) - IC initialization timeout --- ### Telemetry Tests #### `test_all_channels_telemetry()` **Purpose**: Test telemetry reading for all 6 channels **Operations**: 1. Iterate through all channels (CH0-CH5) 2. For each channel, test: - `GetCurrentSetpoint()` - Read current setpoint - `GetAverageCurrent()` - Read average current - `GetDutyCycle()` - Read PWM duty cycle - `GetChannelDiagnostics()` - Read complete diagnostics 3. Report faults and warnings **Expected Result**: ‚úÖ PASS - All telemetry functions work for all channels - Values read successfully (may be 0 if channels not enabled) **Telemetry Data Read**: - Current setpoint (mA) - Average current (mA) - Duty cycle (raw 16-bit value) - Diagnostics (faults, warnings, min/max current) --- #### `test_device_telemetry()` **Purpose**: Test device-level telemetry reading **Operations**: 1. Read device status (`GetDeviceStatus()`) 2. Read VBAT voltage (`GetVbatVoltage()`) 3. Read VIO voltage (`GetVioVoltage()`) 4. Read fault pin status (`IsFault()`) **Expected Result**: ‚úÖ PASS - All device telemetry functions work - Status information displayed - Voltage readings obtained **Telemetry Data Read**: - Device mode (Config/Mission) - Initialization status - Fault conditions - Supply voltages (VBAT, VIO) - Fault pin state --- #### `test_telemetry_with_active_channel()` **Purpose**: Test telemetry with an active channel (enabled with current set) **Operations**: 1. Enter Mission Mode 2. Enable outputs (EN pin) 3. Set current setpoint to 500mA 4. Enable channel 5. Wait for current to stabilize (500ms) 6. Read all telemetry: - Current setpoint - Average current - Duty cycle - Complete diagnostics 7. Verify values are reasonable 8. Disable channel **Expected Result**: ‚úÖ PASS - All telemetry functions work with active channel - Current setpoint matches set value - Average current is measured - Duty cycle is non-zero - Diagnostics show channel is active **Telemetry Validation**: - Setpoint matches configured value - Average current is within reasonable range - Duty cycle reflects current regulation - No unexpected faults --- ### Mode Control Tests #### `test_mode_transitions()` **Purpose**: Validate mode transitions work correctly **Operations**: 1. Perform 3 cycles of Config ‚Üí Mission ‚Üí Config transitions 2. Verify mode state after each transition 3. Ensure no errors occur **Expected Result**: ‚úÖ PASS - All mode transitions succeed - Mode state is correct after each transition - No communication errors --- ### Error Condition Tests #### `test_error_conditions()` **Purpose**: Verify proper error handling **Operations**: 1. Try to enable channel in Config Mode (should fail) 2. Try to configure channel mode in Mission Mode (should fail) 3. Try to configure global settings in Mission Mode (should fail) 4. Verify all operations correctly return errors **Expected Result**: ‚úÖ PASS - All invalid operations correctly rejected - Appropriate error codes returned - No crashes or undefined behavior --- ## Troubleshooting ### Common Issues #### 1. All Tests Fail ‚ùå **Symptom**: Every test returns FAILED **Root Causes**: - TLE92466ED not powered (check VIO: 3.0-5.5V, typical 3.3V or 5.0V) - SPI wiring incorrect - Common ground missing - ESP32-C6 not programmed correctly **Solutions**: ```bash # Check wiring - VIO: 3.0-5.5V present (REQUIRED for SPI, typical 3.3V or 5.0V) - GND: Common ground between ESP32-C6, TLE92466ED - SPI pins: MISO, MOSI, SCLK, CS connected correctly - RESN: Must be HIGH (not in reset) # Re-flash idf.py -p /dev/ttyUSB0 erase-flash idf.py -p /dev/ttyUSB0 flash ``` --- #### 2. HAL Initialization Fails ‚ùå **Symptom**: `test_hal_initialization` fails **Root Causes**: - SPI2 bus already in use - GPIO pins conflicting - Invalid SPI configuration **Solutions**: 1. Check `sdkconfig` for SPI conflicts 2. Verify GPIO pins are not used elsewhere 3. Try different GPIO pins (modify `TLE92466ED_TestConfig.hpp`) 4. Check ESP32-C6 hardware --- #### 3. Driver Initialization Fails ‚ùå **Symptom**: `test_driver_initialization` fails **Root Causes**: - SPI communication not working - TLE92466ED not responding - Power supply issue (VIO required for SPI) **Solutions**: 1. Verify SPI with logic analyzer/oscilloscope 2. Check VIO voltage (must be 3.0V to 5.5V, typical 3.3V or 5.0V) 3. Check VBAT voltage if testing with loads (5.5V to 41V, typical 12V or 24V) 4. Verify RESN pin is HIGH (not in reset) 5. Verify TLE92466ED is not damaged 6. Check VDD voltage (must be 5V) - powers central logic of the IC 7. Check VIO voltage (must be 3.0V to 5.5V, typical 3.3V or 5.0V) - sets SPI I/O levels --- #### 4. Telemetry Tests Fail ‚ö†Ô∏è **Symptom**: Telemetry reading functions fail **Root Causes**: - Channels not enabled (expected for some tests) - Device not in correct mode - Register read errors **Solutions**: 1. Check if test expects channels to be enabled 2. Verify device is in correct mode (Config vs Mission) 3. Check SPI communication is working 4. Some telemetry failures are expected if channels are disabled --- ## Performance Characteristics ### Typical Execution Times | Test Section | Expected Time | Max Time |--------------|--------------|----------| Initialization Tests | 50-100 ms | 200 ms | Mode Control Tests | 30-50 ms | 100 ms | Global Configuration Tests | 200-300 ms | 500 ms | Channel Control Tests | 500-800 ms | 1500 ms | Current Control Tests | 2000-3000 ms | 5000 ms | PWM Configuration Tests | 300-500 ms | 1000 ms | Dither Configuration Tests | 300-500 ms | 1000 ms | Diagnostics Tests | 1000-1500 ms | 3000 ms | Fault Management Tests | 100-200 ms | 400 ms | Watchdog Tests | 200-300 ms | 500 ms | GPIO Control Tests | 200-300 ms | 500 ms | Multi-Channel Tests | 2000-3000 ms | 5000 ms | Parallel Operation Tests | 300-500 ms | 1000 ms | Error Condition Tests | 100-200 ms | 400 ms | **Total Suite** | **~10-15 seconds** | **~30 seconds** | ### Memory Usage | Resource | Usage | Notes |----------|-------|-------| **Flash** | ~350KB | Driver + HAL + test framework | **RAM (static)** | ~15KB | Driver instance + buffers | **Stack (per task)** | 8KB | Configurable in `RUN_TEST_IN_TASK` | **Heap (dynamic)** | ~5KB | HAL instance + std::unique_ptr | ### SPI Performance - **Clock Frequency**: 1MHz (datasheet range: 0.1MHz - 10MHz) - **Transaction Time**: ~32Œºs per 32-bit frame - **Register Read**: ~100Œºs (including overhead) - **Register Write**: ~80Œºs (including overhead) --- ## Related Documentation ### ESP32 Examples - [Solenoid Control Test](readme_solenoid_control_test.md) - Real hardware solenoid testing - [Test Framework Reference](../main/TLE92466ED_TestFramework.hpp) - Framework API - [Hardware Configuration](../main/TLE92466ED_TestConfig.hpp) - Pin and parameter config - [ESP32-C6 CommInterface](../main/Esp32TleCommInterface.hpp) - CommInterface implementation details ### Driver Documentation - [Driver API Reference](../../../docs/07_Driver_API.md) - Complete API documentation - [CommInterface Implementation Guide](../../../docs/08_HAL_Implementation.md) - Porting to new platforms - [Register Map](../../../docs/03_Register_Map.md) - TLE92466ED register details - [Diagnostics](../../../docs/06_Diagnostics.md) - Fault detection and handling ### Build System - [App Configuration](/hf-tle92466ed-driver/development/examples/esp32/app_config.yml) - Build metadata - [CMake Setup](/hf-tle92466ed-driver/development/examples/esp32/CMakeLists.txt) - Build system configuration - [Component Structure](../components/hf_tle92466ed/) - ESP-IDF component --- ## Notes - This test suite is designed to validate driver functionality without requiring actual solenoids - All tests are independent and can be enabled/disabled individually - The suite validates both high-level and low-level APIs - Error conditions are tested to ensure proper validation - The suite covers all driver functionality - Test execution time depends on enabled sections (typically 10-15 seconds for full suite) - **VBAT is not required** for this test - only VDD and VIO are needed for SPI communication --- **Example**: Driver Integration Test Suite **Platform**: ESP32-C6 **Framework**: FreeRTOS + Test Framework **Test Sections**: 13 **Total Tests**: 40+ **Status**: ‚úÖ Production Ready **Hardware Required**: TLE92466ED IC (no solenoids needed) ",
    "url": "/hf-tle92466ed-driver/development/examples/esp32/docs/README_DRIVER_INTEGRATION_TEST.html",
    
    "relUrl": "/examples/esp32/docs/README_DRIVER_INTEGRATION_TEST.html"
  },"11": {
    "doc": "Solenoid Control Test - TLE92466ED ESP32-C6",
    "title": "Solenoid Control Test - TLE92466ED ESP32-C6",
    "content": "# Solenoid Control Test - TLE92466ED ESP32-C6 ## Table of Contents 1. [Overview](#overview) 2. [Purpose](#purpose) 3. [Hardware Requirements](#hardware-requirements) 4. [System Architecture](#system-architecture) 5. [Hardware Setup](#hardware-setup) 6. [Configuration](#configuration) 7. [Building and Running](#building-and-running) 8. [Operation](#operation) 9. [Real-Time Telemetry](#real-time-telemetry) 10. [Control Algorithm](#control-algorithm) 11. [Troubleshooting](#troubleshooting) 12. [Performance Characteristics](#performance-characteristics) 13. [Safety Considerations](#safety-considerations) 14. [Related Documentation](#related-documentation) --- ## Overview The **Solenoid Control Test** is a real hardware test application that demonstrates actual solenoid control using the TLE92466ED driver. This test uses **ADC-based current control** where an analog voltage input (0-3.3V) controls the current setpoint for two solenoids, with real-time telemetry monitoring. ### Key Features - **Real Hardware Testing**: Tests actual solenoids, not just driver logic - **ADC-Based Control**: Analog voltage input (0-3.3V) maps to current percentage (0-100%) - **Dual Solenoid Setup**: One single channel, one parallel pair - **Independent Current Ranges**: Each solenoid has different min/max but same percentage mapping - **Real-Time Telemetry**: Monitoring every 1 second - **Continuous Operation**: Runs indefinitely until reset ### Test Configuration ``` ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Solenoid Configuration ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îÇ ‚îÇ Solenoid 1 (Single Channel): ‚îÇ ‚îÇ ‚îî‚îÄ Channel: CH0 ‚îÇ ‚îÇ ‚îî‚îÄ Mode: Single Channel (ICC) ‚îÇ ‚îÇ ‚îî‚îÄ Current Range: 200-1500 mA ‚îÇ ‚îÇ ‚îî‚îÄ Percentage Mapping: 0-100% ‚Üí 200-1500 mA ‚îÇ ‚îÇ ‚îÇ ‚îÇ Solenoid 2 (Parallel Pair): ‚îÇ ‚îÇ ‚îî‚îÄ Channels: CH1/CH2 (Parallel) ‚îÇ ‚îÇ ‚îî‚îÄ Mode: Parallel Pair (ICC) ‚îÇ ‚îÇ ‚îî‚îÄ Current Range: 400-3000 mA ‚îÇ ‚îÇ ‚îî‚îÄ Percentage Mapping: 0-100% ‚Üí 400-3000 mA ‚îÇ ‚îÇ ‚îÇ ‚îÇ Control Input: ‚îÇ ‚îÇ ‚îî‚îÄ ADC Pin: GPIO0 (ADC1_CH0) ‚îÇ ‚îÇ ‚îî‚îÄ Voltage Range: 0-3.3V ‚îÇ ‚îÇ ‚îî‚îÄ Maps to: 0-100% current for both solenoids ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ``` --- ## Purpose This test serves multiple purposes: 1. **Real Hardware Validation**: Tests actual solenoid operation with real loads 2. **Parallel Operation Verification**: Validates parallel channel pairing works correctly 3. **Current Control Accuracy**: Tests current regulation with real solenoids 4. **Telemetry Validation**: Demonstrates real-time monitoring capabilities 5. **System Integration**: Tests complete system from ADC input to solenoid output 6. **Performance Evaluation**: Measures actual current regulation accuracy **Note**: This test requires actual solenoids and proper power supplies. For driver-only testing without hardware, use the **Driver Integration Test**. --- ## Hardware Requirements ### Required Components - **ESP32-C6-DevKitC-1** development board - **TLE92466ED** evaluation board or custom PCB - **Two Solenoids** with appropriate current ratings: - Solenoid 1: 200-1500mA range - Solenoid 2: 400-3000mA range (parallel pair) - **5.5-41V Power Supply** for VBAT (5A+ recommended for parallel operation, typical: 12V or 24V automotive) - **3.0-5.5V Power Supply** for VIO (I/O level supply for SPI, typical: 3.3V or 5.0V) - **5V Power Supply** for VDD (internal logic supply) - *Required for IC operation* - **ADC Control Source**: Potentiometer, DAC, or voltage source (0-3.3V) - **Current Sense Resistors** (if using external current monitoring) - **Oscilloscope/Logic Analyzer** (optional, for signal analysis) - Connecting wires and appropriate connectors ### Power Supply Requirements ``` ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Power Supply Specifications ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îÇ ‚îÇ VDD (Internal Logic Supply): ‚îÇ ‚îÇ ‚îî‚îÄ Voltage: 5V input to TLE92466ED ‚îÇ ‚îÇ ‚îî‚îÄ Purpose: Powers central logic of the IC ‚îÇ ‚îÇ ‚îî‚îÄ Required: YES (for IC operation) ‚îÇ ‚îÇ ‚îÇ ‚îÇ VIO (I/O Level Supply): ‚îÇ ‚îÇ ‚îî‚îÄ Voltage: 3.0V to 5.5V (input) ‚îÇ ‚îÇ ‚îî‚îÄ Purpose: Sets I/O voltage levels for SPI ‚îÇ ‚îÇ ‚îî‚îÄ Typical: 3.3V or 5.0V ‚îÇ ‚îÇ ‚îî‚îÄ Current: 10-20mA ‚îÇ ‚îÇ ‚îî‚îÄ Required: YES (for SPI communication) ‚îÇ ‚îÇ ‚îÇ ‚îÇ VBAT (Load Supply): ‚îÇ ‚îÇ ‚îî‚îÄ Voltage: 5.5V to 41V (recommended operating) ‚îÇ ‚îÇ ‚îî‚îÄ Typical: 12V or 24V automotive ‚îÇ ‚îÇ ‚îî‚îÄ Current: 5A+ (for parallel operation) ‚îÇ ‚îÇ ‚îî‚îÄ Required: YES (for solenoid operation) ‚îÇ ‚îÇ ‚îî‚îÄ Note: Must be capable of supplying peak currents ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ``` ### Solenoid Specifications **Solenoid 1 (Single Channel)**: - Recommended current range: 200-1500mA - Typical resistance: 6-120Œ© - Power rating: 2.4-18W at 12V - Must be rated for continuous operation **Solenoid 2 (Parallel Pair)**: - Recommended current range: 400-3000mA - Typical resistance: 3-60Œ© (combined) - Power rating: 4.8-36W at 12V - Must be rated for continuous operation - Requires proper current sharing between CH1 and CH2 --- ## System Architecture ### Block Diagram ``` ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ System Architecture ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ ‚îÇ Control ‚îÇ ‚îÇ ESP32-C6 ‚îÇ ‚îÇ ‚îÇ ‚îÇ Source ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ ‚îÇ ‚îÇ Pot/DAC ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ>‚îÇ ‚îÇ ADC (GPIO0) ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ 0-3.3V ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚ñº ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ Control ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ Logic ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚ñº ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ TLE92466ED ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ Driver ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ ‚îÇ TLE92466ED ‚îÇ ‚îÇ TLE92466ED ‚îÇ ‚îÇ ‚îÇ ‚îÇ IC ‚îÇ ‚îÇ IC ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ ‚îÇ Solenoid 1 ‚îÇ ‚îÇ Solenoid 2 ‚îÇ ‚îÇ ‚îÇ ‚îÇ (CH0) ‚îÇ ‚îÇ (CH1/CH2) ‚îÇ ‚îÇ ‚îÇ ‚îÇ 200-1500mA ‚îÇ ‚îÇ 400-3000mA ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ``` ### Control Flow ``` ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Control Flow Diagram ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îÇ ‚îÇ 1. ADC Reading (100ms) ‚îÇ ‚îÇ ‚îî‚îÄ> Read GPIO0 voltage (0-3.3V) ‚îÇ ‚îÇ ‚îî‚îÄ> Convert to percentage (0-100%) ‚îÇ ‚îÇ ‚îÇ ‚îÇ 2. Current Calculation ‚îÇ ‚îÇ ‚îî‚îÄ> Solenoid 1: percentage ‚Üí 200-1500mA ‚îÇ ‚îÇ ‚îî‚îÄ> Solenoid 2: percentage ‚Üí 400-3000mA ‚îÇ ‚îÇ ‚îÇ ‚îÇ 3. Current Update ‚îÇ ‚îÇ ‚îî‚îÄ> SetCurrentSetpoint(Solenoid 1) ‚îÇ ‚îÇ ‚îî‚îÄ> SetCurrentSetpoint(Solenoid 2) ‚îÇ ‚îÇ ‚îÇ ‚îÇ 4. Telemetry Collection (1 second) ‚îÇ ‚îÇ ‚îî‚îÄ> Read device status ‚îÇ ‚îÇ ‚îî‚îÄ> Read channel diagnostics ‚îÇ ‚îÇ ‚îî‚îÄ> Read voltages (VBAT, VIO) ‚îÇ ‚îÇ ‚îî‚îÄ> Read currents (setpoint, actual) ‚îÇ ‚îÇ ‚îî‚îÄ> Read duty cycles ‚îÇ ‚îÇ ‚îî‚îÄ> Check faults and warnings ‚îÇ ‚îÇ ‚îÇ ‚îÇ 5. Display Telemetry ‚îÇ ‚îÇ ‚îî‚îÄ> Format and print status ‚îÇ ‚îÇ ‚îÇ ‚îÇ Loop: Steps 1-5 repeat continuously ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ``` --- ## Hardware Setup ### Complete Wiring Diagram ``` ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Complete Wiring ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îÇ ‚îÇ ESP32-C6 TLE92466ED ‚îÇ ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ ‚îÇ ‚îÇ ‚îÇ GPIO2 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> MISO ‚îÇ ‚îÇ GPIO7 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> MOSI ‚îÇ ‚îÇ GPIO6 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> SCLK ‚îÇ ‚îÇ GPIO18 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> CS ‚îÇ ‚îÇ GPIO21 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> RESN ‚îÇ ‚îÇ GPIO20 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> EN ‚îÇ ‚îÇ GPIO19 VDD ‚îÇ ‚îÇ 3.3V ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> VIO ‚îÇ ‚îÇ GND ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> GND ‚îÇ ‚îÇ ‚îÇ ‚îÇ External Supply TLE92466ED ‚îÇ ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ ‚îÇ ‚îÇ ‚îÇ 5.5-41V (12-24V typical) ‚îÄ‚îÄ> VBAT ‚îÇ ‚îÇ GND ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> GND ‚îÇ ‚îÇ ‚îÇ ‚îÇ Solenoid 1 TLE92466ED ‚îÇ ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ ‚îÇ ‚îÇ ‚îÇ Solenoid+ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> OUT0 (CH0) ‚îÇ ‚îÇ Solenoid- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> GND (via sense) ‚îÇ ‚îÇ ‚îÇ ‚îÇ Solenoid 2 TLE92466ED ‚îÇ ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ ‚îÇ ‚îÇ ‚îÇ Solenoid+ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> OUT1 (CH1) ‚îÄ‚îÄ‚îê ‚îÇ ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ> OUT2 (CH2) ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ Solenoid- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ> GND (via sense) ‚îÇ ‚îÇ ‚îÇ ‚îÇ Control Source ESP32-C6 ‚îÇ ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ ‚îÇ ‚îÇ ‚îÇ Potentiometer: ‚îÇ ‚îÇ 3.3V ‚îÄ‚îÄ[R1]‚îÄ‚îÄ‚îÄ GPIO0 ‚îÄ‚îÄ[R2]‚îÄ‚îÄ‚îÄ GND ‚îÇ ‚îÇ (or DAC, voltage source, etc.) ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ``` ### Pin Assignment Table | Function | ESP32-C6 GPIO | TLE92466ED Pin | Direction | Notes |----------|---------------|----------------|-----------|-------| **SPI MISO** | GPIO2 | MISO | Input | Data from TLE92466ED | **SPI MOSI** | GPIO7 | MOSI | Output | Data to TLE92466ED | **SPI SCLK** | GPIO6 | SCLK | Output | 1MHz SPI Clock | **SPI CS** | GPIO18 | CS | Output | Active Low | **RESN** | GPIO21 | RESN | Output | Reset pin (active low, must be HIGH) | **EN** | GPIO20 | EN | Output | Enable pin (active high) | **FAULTN** | GPIO19 | FAULTN | Input | Fault pin (active low) | **ADC Input** | GPIO0 | - | Input | Control voltage (0-3.3V) | **VDD Supply** | 5V | VDD | Power | 5V (Required) | **VIO Supply** | 3.3V/5V | VIO | Power | 3.0-5.5V (Required) | **Load Supply** | 12-24V typical | VBAT | Power | 5.5-41V, 5A+ recommended (Required) | **Ground** | GND | GND | Ground | Common reference | ### Solenoid Connections **Solenoid 1 (Single Channel - CH0)**: ``` Solenoid Terminal+ ‚îÄ‚îÄ‚îÄ‚îÄ> TLE92466ED OUT0 Solenoid Terminal- ‚îÄ‚îÄ‚îÄ‚îÄ> GND (via current sense resistor if used) ``` **Solenoid 2 (Parallel Pair - CH1/CH2)**: ``` Solenoid Terminal+ ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ> TLE92466ED OUT1 (CH1) ‚îî‚îÄ‚îÄ‚îÄ> TLE92466ED OUT2 (CH2) Solenoid Terminal- ‚îÄ‚îÄ‚îÄ‚îÄ> GND (via current sense resistor if used) ``` **Important Notes**: - Both channels in parallel pair must be connected to the same solenoid - Ensure proper current sharing between CH1 and CH2 - Use appropriate wire gauge for high currents (parallel operation) - Add current sense resistors if external current monitoring is desired ### ADC Control Input Setup **Option 1: Potentiometer** ``` 3.3V ‚îÄ‚îÄ[10kŒ© Pot]‚îÄ‚îÄ GPIO0 ‚îÇ GND ``` **Option 2: DAC Output** ``` DAC Output (0-3.3V) ‚îÄ‚îÄ> GPIO0 ``` **Option 3: Voltage Source** ``` Variable Voltage Source (0-3.3V) ‚îÄ‚îÄ> GPIO0 ``` **ADC Configuration**: - Pin: GPIO0 (ADC1_CH0) - Range: 0-3.3V - Resolution: 12-bit (0-4095) - Attenuation: 12dB (full range) - Sampling: 1kHz --- ## Configuration ### Solenoid Configuration (`main/SolenoidControlTest.cpp`) ```cpp /** * @brief Solenoid 1 Configuration (Single Channel) */ struct Solenoid1Config { static constexpr Channel CHANNEL = Channel::CH0; // Single channel static constexpr uint16_t MIN_CURRENT_MA = 200; // Minimum current (mA) static constexpr uint16_t MAX_CURRENT_MA = 1500; // Maximum current (mA) static constexpr bool PARALLEL_MODE = false; // Single channel mode }; /** * @brief Solenoid 2 Configuration (Parallel Pair) */ struct Solenoid2Config { static constexpr ParallelPair PAIR = ParallelPair::CH1_CH2; // Parallel pair static constexpr Channel PRIMARY_CHANNEL = Channel::CH1; // Primary channel static constexpr uint16_t MIN_CURRENT_MA = 400; // Minimum current (mA) static constexpr uint16_t MAX_CURRENT_MA = 3000; // Maximum current (mA) static constexpr bool PARALLEL_MODE = true; // Parallel mode }; ``` **To modify solenoid configuration**: Edit these structs in `main/SolenoidControlTest.cpp` ### ADC Configuration ```cpp /** * @brief ADC Configuration */ struct ADCConfig { static constexpr adc_unit_t UNIT = ADC_UNIT_1; // ADC unit (ADC1) static constexpr adc_channel_t CHANNEL = ADC_CHANNEL_0; // ADC channel (GPIO0) static constexpr adc_atten_t ATTEN = ADC_ATTEN_DB_12; // 0-3.3V range static constexpr adc_bitwidth_t BITWIDTH = ADC_BITWIDTH_12; // 12-bit resolution static constexpr float VREF_MV = 3300.0f; // Reference voltage (3.3V) static constexpr float ADC_MAX = 4095.0f; // Maximum ADC value static constexpr int GPIO_PIN = 0; // GPIO pin number }; ``` **To change ADC pin**: Modify `CHANNEL` and `GPIO_PIN` (ensure GPIO supports ADC) ### Control Loop Timing ```cpp const TickType_t update_interval = pdMS_TO_TICKS(100); // 100ms current update const TickType_t telemetry_interval = pdMS_TO_TICKS(1000); // 1 second telemetry ``` **To modify timing**: Edit these constants in `main/SolenoidControlTest.cpp` --- ## Building and Running ### Quick Start ```bash cd examples/esp32 # Build the solenoid control test ./scripts/build_app.sh solenoid_control_test Debug # Flash to ESP32-C6 ./scripts/flash_app.sh solenoid_control_test Debug # Monitor output ./scripts/monitor_app.sh solenoid_control_test ``` ### Manual Build ```bash cd examples/esp32 # Set target idf.py set-target esp32c6 # Build with APP_TYPE=solenoid_control_test idf.py -DAPP_TYPE=solenoid_control_test build # Flash idf.py -p /dev/ttyUSB0 flash # Monitor idf.py -p /dev/ttyUSB0 monitor ``` ### Build Requirements The solenoid control test requires the `esp_adc` component, which is automatically added by CMake when `APP_TYPE=solenoid_control_test`. --- ## Operation ### Startup Sequence ``` ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Startup Sequence ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îÇ ‚îÇ 1. Initialize HAL ‚îÇ ‚îÇ ‚îî‚îÄ> Create Esp32TleCommInterface ‚îÇ ‚îÇ ‚îî‚îÄ> Initialize SPI bus ‚îÇ ‚îÇ ‚îî‚îÄ> Configure GPIO pins ‚îÇ ‚îÇ ‚îÇ ‚îÇ 2. Initialize Driver ‚îÇ ‚îÇ ‚îî‚îÄ> Create tle92466ed::Driver instance ‚îÇ ‚îÇ ‚îî‚îÄ> Call Init() (resets device, verifies communication) ‚îÇ ‚îÇ ‚îÇ ‚îÇ 3. Initialize ADC ‚îÇ ‚îÇ ‚îî‚îÄ> Configure ADC1 channel 0 (GPIO0) ‚îÇ ‚îÇ ‚îî‚îÄ> Set attenuation for 0-3.3V range ‚îÇ ‚îÇ ‚îî‚îÄ> Enable calibration (if available) ‚îÇ ‚îÇ ‚îÇ ‚îÇ 4. Configure Solenoids ‚îÇ ‚îÇ ‚îî‚îÄ> Enter Config Mode ‚îÇ ‚îÇ ‚îî‚îÄ> Set Solenoid 1 to ICC mode (CH0) ‚îÇ ‚îÇ ‚îî‚îÄ> Enable parallel operation for Solenoid 2 (CH1/CH2) ‚îÇ ‚îÇ ‚îî‚îÄ> Set Solenoid 2 to ICC mode (CH1) ‚îÇ ‚îÇ ‚îî‚îÄ> Enter Mission Mode ‚îÇ ‚îÇ ‚îî‚îÄ> Enable outputs (EN pin) ‚îÇ ‚îÇ ‚îÇ ‚îÇ 5. Enable Solenoids ‚îÇ ‚îÇ ‚îî‚îÄ> Enable CH0 (Solenoid 1) ‚îÇ ‚îÇ ‚îî‚îÄ> Enable CH1 (Solenoid 2, enables both in parallel) ‚îÇ ‚îÇ ‚îÇ ‚îÇ 6. Start Control Loop ‚îÇ ‚îÇ ‚îî‚îÄ> Continuous operation begins ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ``` ### Control Loop Operation The control loop runs continuously with the following timing: ``` ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Control Loop Timing ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îÇ ‚îÇ Every 100ms: ‚îÇ ‚îÇ ‚îî‚îÄ> Read ADC voltage (GPIO0) ‚îÇ ‚îÇ ‚îî‚îÄ> Convert to percentage (0-100%) ‚îÇ ‚îÇ ‚îî‚îÄ> Calculate currents for both solenoids ‚îÇ ‚îÇ ‚îî‚îÄ> Update current setpoints ‚îÇ ‚îÇ ‚îÇ ‚îÇ Every 1 second: ‚îÇ ‚îÇ ‚îî‚îÄ> Collect telemetry ‚îÇ ‚îÇ ‚îî‚îÄ> Display formatted telemetry report ‚îÇ ‚îÇ ‚îÇ ‚îÇ Continuous: ‚îÇ ‚îÇ ‚îî‚îÄ> Monitor for faults ‚îÇ ‚îÇ ‚îî‚îÄ> Update currents based on ADC ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ``` ### Current Calculation The ADC reading (0-3.3V) is mapped to a percentage (0-100%), which is then used to calculate the current for each solenoid: ``` ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Current Calculation Formula ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îÇ ‚îÇ Step 1: ADC to Percentage ‚îÇ ‚îÇ percentage = (ADC_voltage / 3.3V) √ó 100% ‚îÇ ‚îÇ ‚îÇ ‚îÇ Step 2: Percentage to Current ‚îÇ ‚îÇ Solenoid 1: ‚îÇ ‚îÇ current = 200mA + (1500mA - 200mA) √ó (percentage/100) ‚îÇ ‚îÇ Range: 200-1500mA ‚îÇ ‚îÇ ‚îÇ ‚îÇ Solenoid 2: ‚îÇ ‚îÇ current = 400mA + (3000mA - 400mA) √ó (percentage/100) ‚îÇ ‚îÇ Range: 400-3000mA ‚îÇ ‚îÇ ‚îÇ ‚îÇ Example: ‚îÇ ‚îÇ ADC = 1.65V (50%) ‚îÇ ‚îÇ Solenoid 1: 200 + (1500-200)√ó0.5 = 850mA ‚îÇ ‚îÇ Solenoid 2: 400 + (3000-400)√ó0.5 = 1700mA ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ``` --- ## Real-Time Telemetry ### Telemetry Display Format Every 1 second, the system displays telemetry: ``` ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë REAL-TIME TELEMETRY ‚ïë ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ ADC Input: 1650.0 mV (50.0%) Target Currents: Solenoid 1=850 mA, Solenoid 2=1700 mA Device Status: Mode: Mission | Init: Done | Fault Pin: OK VBAT: 12000 mV | VIO: 3300 mV Solenoid 1 (CH0): Setpoint: 850 mA | Actual: 845 mA | Duty: 16384 (0x4000) Current Error: -5 mA (-0.6%) ‚úÖ Status: Normal Solenoid 2 (CH1): Setpoint: 1700 mA | Actual: 1695 mA | Duty: 32768 (0x8000) Current Error: -5 mA (-0.3%) ‚úÖ Status: Normal ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ``` ### Telemetry Data Explained #### Device-Level Telemetry - **Mode**: Current device mode (Config or Mission) - **Init**: Initialization status (Done or Pending) - **Fault Pin**: Hardware fault pin state (OK or FAULT) - **VBAT**: VBAT supply voltage in millivolts - **VIO**: VIO supply voltage in millivolts - **Device Faults**: Any global fault conditions (UV/OV, temperature, clock, etc.) #### Per-Solenoid Telemetry - **Setpoint**: Target current in milliamperes - **Actual**: Measured average current in milliamperes - **Duty**: PWM duty cycle (raw 16-bit value and hex) - **Current Error**: Difference between setpoint and actual (mA and percentage) - **Faults**: Channel-specific fault conditions - **Warnings**: Channel-specific warning conditions - **Status**: Overall channel status (Normal or with faults/warnings) ### Telemetry Interpretation #### Normal Operation ``` ‚úÖ Status: Normal ``` - No faults or warnings detected - Current regulation working correctly - All systems operational #### Current Error Analysis ``` Current Error: -5 mA (-0.6%) ``` - **Negative error**: Actual current is less than setpoint - **Positive error**: Actual current is greater than setpoint - **Small errors (10%)**: May indicate load mismatch or regulation issues #### Fault Conditions ``` ‚ö†Ô∏è Faults: - Over-current - Short to Ground - Open Load ``` - **Over-current**: Load drawing more than expected - **Short to Ground**: Load or wiring shorted - **Open Load**: No load connected or connection issue - **Over-temperature**: IC or load overheating #### Warning Conditions ``` ‚ö†Ô∏è Warnings: - Current Regulation Warning - PWM Regulation Warning ``` - **Current Regulation Warning**: Current regulation may be at limits - **PWM Regulation Warning**: PWM may be saturated - **OT Warning**: Approaching temperature limits --- ## Control Algorithm ### Current Control Flow ``` ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Current Control Algorithm ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îÇ ‚îÇ 1. ADC Reading ‚îÇ ‚îÇ Input: GPIO0 voltage (0-3.3V) ‚îÇ ‚îÇ Process: 12-bit ADC conversion ‚îÇ ‚îÇ Output: Raw ADC value (0-4095) ‚îÇ ‚îÇ ‚îÇ ‚îÇ 2. Voltage Calculation ‚îÇ ‚îÇ Input: Raw ADC value ‚îÇ ‚îÇ Process: Convert to voltage (with calibration) ‚îÇ ‚îÇ Output: Voltage in millivolts (0-3300mV) ‚îÇ ‚îÇ ‚îÇ ‚îÇ 3. Percentage Calculation ‚îÇ ‚îÇ Input: Voltage (mV) ‚îÇ ‚îÇ Process: percentage = (voltage / 3300) √ó 100 ‚îÇ ‚îÇ Output: Percentage (0.0-100.0%) ‚îÇ ‚îÇ ‚îÇ ‚îÇ 4. Current Calculation (Per Solenoid) ‚îÇ ‚îÇ Input: Percentage ‚îÇ ‚îÇ Process: ‚îÇ ‚îÇ current = min + (max - min) √ó (percentage / 100) ‚îÇ ‚îÇ Output: Current in milliamperes ‚îÇ ‚îÇ ‚îÇ ‚îÇ 5. Current Update ‚îÇ ‚îÇ Input: Calculated current ‚îÇ ‚îÇ Process: SetCurrentSetpoint(channel, current) ‚îÇ ‚îÇ Output: Current setpoint updated in TLE92466ED ‚îÇ ‚îÇ ‚îÇ ‚îÇ 6. Current Regulation (TLE92466ED) ‚îÇ ‚îÇ Input: Current setpoint ‚îÇ ‚îÇ Process: ICC (Integrated Current Control) ‚îÇ ‚îÇ Output: Regulated current to solenoid ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ``` ### Parallel Operation For Solenoid 2 (parallel pair), the current is set on the primary channel (CH1), and the TLE92466ED automatically shares the current between CH1 and CH2: ``` ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Parallel Channel Current Sharing ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îÇ ‚îÇ Setpoint: 1700mA (on CH1) ‚îÇ ‚îÇ ‚îÇ ‚îÇ TLE92466ED automatically: ‚îÇ ‚îÇ ‚îî‚îÄ> Shares current between CH1 and CH2 ‚îÇ ‚îÇ ‚îî‚îÄ> Each channel: ~850mA ‚îÇ ‚îÇ ‚îî‚îÄ> Total: ~1700mA to solenoid ‚îÇ ‚îÇ ‚îÇ ‚îÇ Current Sharing: ‚îÇ ‚îÇ ‚îî‚îÄ> Automatic balancing by TLE92466ED ‚îÇ ‚îÇ ‚îî‚îÄ> No manual current splitting required ‚îÇ ‚îÇ ‚îî‚îÄ> Both channels must be enabled ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ``` --- ## Troubleshooting ### Common Issues #### 1. Solenoids Not Responding ‚ùå **Symptom**: No current flow, solenoids not activating **Root Causes**: - VBAT not connected or insufficient voltage - EN pin not enabled - Channels not enabled - Device not in Mission Mode - Solenoid wiring incorrect **Solutions**: ``` Checklist: ‚ñ° VBAT: 5.5-41V connected (typical 12-24V) and sufficient current capacity ‚ñ° EN pin: HIGH (outputs enabled) ‚ñ° Channels: Enabled via EnableChannel() ‚ñ° Mode: Mission Mode (EnterMissionMode()) ‚ñ° Wiring: Solenoid+ to OUT, Solenoid- to GND ‚ñ° RESN: HIGH (not in reset) ``` --- #### 2. Current Not Regulating Correctly ‚ö†Ô∏è **Symptom**: Actual current doesn't match setpoint **Root Causes**: - Load resistance mismatch - Power supply voltage too low - Current limits exceeded - Solenoid resistance out of range **Solutions**: ``` 1. Check load resistance: - Solenoid 1: R = VBAT / I_max = 12V / 1.5A = 8Œ© minimum - Solenoid 2: R = VBAT / I_max = 12V / 3.0A = 4Œ© minimum 2. Verify power supply: - VBAT voltage: 5.5V to 41V (typical 12-24V) - Current capacity: 5A+ for parallel operation 3. Check telemetry: - Current error should be 1000mA)** | ¬±2-5% | ¬±10% | **Parallel Operation** | ¬±3-7% | ¬±12% | **Note**: Accuracy depends on load characteristics, power supply stability, and temperature. ### Power Consumption | Component | Typical Current | Notes |-----------|----------------|-------| **ESP32-C6 (Idle)** | 20-30mA | Without WiFi/BLE | **ESP32-C6 (Active)** | 50-80mA | During operation | **TLE92466ED (VDD)** | - | 5V input (powers central logic) | **TLE92466ED (VIO)** | 10-20mA | I/O level supply (for SPI) | **Solenoid 1 (Max)** | 1500mA | At maximum setpoint | **Solenoid 2 (Max)** | 3000mA | At maximum setpoint (parallel) | --- ## Safety Considerations ### Electrical Safety ``` ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Safety Guidelines ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îÇ ‚îÇ ‚ö†Ô∏è HIGH VOLTAGE WARNING ‚îÇ ‚îÇ ‚îî‚îÄ> VBAT can be up to 41V (recommended operating) ‚îÇ ‚îÇ ‚îî‚îÄ> Use appropriate safety measures ‚îÇ ‚îÇ ‚îî‚îÄ> Ensure proper grounding ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚ö†Ô∏è HIGH CURRENT WARNING ‚îÇ ‚îÇ ‚îî‚îÄ> Parallel operation can draw 3A+ ‚îÇ ‚îÇ ‚îî‚îÄ> Use appropriate wire gauge ‚îÇ ‚îÇ ‚îî‚îÄ> Ensure connectors are rated for current ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚ö†Ô∏è THERMAL CONSIDERATIONS ‚îÇ ‚îÇ ‚îî‚îÄ> TLE92466ED can get hot during operation ‚îÇ ‚îÇ ‚îî‚îÄ> Add heatsink if needed ‚îÇ ‚îÇ ‚îî‚îÄ> Monitor temperature via telemetry ‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚ö†Ô∏è SHORT CIRCUIT PROTECTION ‚îÇ ‚îÇ ‚îî‚îÄ> TLE92466ED has built-in protection ‚îÇ ‚îÇ ‚îî‚îÄ> Monitor FAULTN pin ‚îÇ ‚îÇ ‚îî‚îÄ> Check telemetry for fault conditions ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ``` ### Operational Safety 1. **Start with Low Currents**: Begin testing at minimum current setpoints 2. **Monitor Telemetry**: Watch for faults and warnings 3. **Check Temperatures**: Ensure adequate cooling 4. **Verify Wiring**: Double-check all connections before powering on 5. **Use Fuses**: Add appropriate fuses in power supply lines 6. **Emergency Stop**: Have a way to quickly disable power (EN pin or power supply) --- ## Related Documentation ### ESP32 Examples - [Driver Integration Test](readme_driver_integration_test.md) - Driver API validation (no hardware) - [Test Framework Reference](../main/TLE92466ED_TestFramework.hpp) - Framework API - [Hardware Configuration](../main/TLE92466ED_TestConfig.hpp) - Pin and parameter config - [ESP32-C6 CommInterface](../main/Esp32TleCommInterface.hpp) - CommInterface implementation ### Driver Documentation - [Driver API Reference](../../../docs/07_Driver_API.md) - Complete API documentation - [CommInterface Implementation Guide](../../../docs/08_HAL_Implementation.md) - Porting to new platforms - [Register Map](../../../docs/03_Register_Map.md) - TLE92466ED register details - [Diagnostics](../../../docs/06_Diagnostics.md) - Fault detection and handling ### Hardware Documentation - [TLE92466ED Datasheet](../../../Datasheet/) - Complete IC specifications - [ESP32-C6 Technical Reference](https://www.espressif.com/sites/default/files/documentation/esp32-c6_technical_reference_manual_en.pdf) - MCU documentation --- ## Notes - This test requires actual solenoids and proper power supplies - VBAT is **required** for solenoid operation (unlike driver integration test) - Both solenoids use the same ADC percentage but different current ranges - Parallel operation automatically shares current between channels - Telemetry updates every 1 second - Control loop updates every 100ms for responsive current control - The test runs continuously until reset or power cycle --- **Example**: Solenoid Control Test **Platform**: ESP32-C6 **Framework**: FreeRTOS **Status**: ‚úÖ Production Ready **Hardware Required**: TLE92466ED IC + Two Solenoids + Power Supplies ",
    "url": "/hf-tle92466ed-driver/development/examples/esp32/docs/README_SOLENOID_CONTROL_TEST.html",
    
    "relUrl": "/examples/esp32/docs/README_SOLENOID_CONTROL_TEST.html"
  },"12": {
    "doc": "TLE92466ED Test Framework Documentation",
    "title": "TLE92466ED Test Framework Documentation",
    "content": "# TLE92466ED Test Framework Documentation ## Overview The **TLE92466ED Test Framework** (`TLE92466ED_TestFramework.hpp`) provides professional testing infrastructure for ESP32-based examples, adapted from the HardFOC Internal Interface Wrap test framework. ## üéØ Purpose - **Structured Testing**: Organize tests into logical sections - **Automatic Tracking**: Pass/fail counting and execution timing - **Visual Feedback**: GPIO14 progress indicator - **Task Isolation**: FreeRTOS task-based execution - **CI/CD Ready**: Structured output for automated testing ## üìö Framework Components ### 1. GPIO14 Test Progression Indicator #### Purpose Provides **hardware-level visual feedback** showing test progression on oscilloscope, logic analyzer, or LED. #### Functions ```cpp bool init_test_progress_indicator() noexcept; ```text **Initialize GPIO14** as output for test progression indicator - Configures GPIO14 as push-pull output - Sets initial state to LOW - Returns `true` on success ```cpp void flip_test_progress_indicator() noexcept; ```text **Toggle GPIO14** state to indicate test completion - Alternates between HIGH and LOW - Called automatically after each test - 50ms delay for visual effect ```cpp void output_section_indicator(uint8_t blink_count = 5) noexcept; ```text **Blink GPIO14** to indicate section boundaries - Default: 5 blinks (50ms ON, 50ms OFF each) - Custom blink count for different sections - Marks state as LOW after completion ```cpp void cleanup_test_progress_indicator() noexcept; ```text **Cleanup and reset** GPIO14 - Sets pin to LOW - Resets pin configuration - Called before system restart #### Signal Patterns ```text Section Start: ‚îå‚îÄ‚îê ‚îå‚îÄ‚îê ‚îå‚îÄ‚îê ‚îå‚îÄ‚îê ‚îå‚îÄ‚îê ‚îî‚îÄ‚îò ‚îî‚îÄ‚îò ‚îî‚îÄ‚îò ‚îî‚îÄ‚îò ‚îî‚îÄ‚îò (5 blinks, 50ms each) Test Complete: ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê (Toggle HIGH) ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò Next Test: ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ (Toggle LOW) ```text #### Hardware Setup ```text ESP32-C6 GPIO14 ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ LED Anode ‚îÇ ‚îî‚îÄ‚îÄ LED Cathode ‚îÄ‚îÄ 220Œ© ‚îÄ‚îÄ GND ‚îÇ ‚îî‚îÄ‚îÄ Oscilloscope/Logic Analyzer Probe ```text --- ### 2. Test Result Tracking #### TestResults Structure ```cpp struct TestResults { int total_tests; // Total number of tests run int passed_tests; // Number of tests passed int failed_tests; // Number of tests failed uint64_t total_execution_time_us; // Total execution time (Œºs) void add_result(bool passed, uint64_t execution_time) noexcept; double get_success_percentage() const noexcept; double get_total_time_ms() const noexcept; void print_summary(const char* tag) const noexcept; }; ```text #### Global Instance ```cpp static TestResults g_test_results; ```text Automatically accumulates results from all tests. Accessed via macros. #### Methods **`add_result(passed, execution_time)`** - Records test result - Updates pass/fail counters - Accumulates execution time - Called automatically by test macros **`get_success_percentage()`** - Returns success rate (0.0 to 100.0) - Handles division by zero **`get_total_time_ms()`** - Returns total execution time in milliseconds - Converts from microseconds **`print_summary(tag)`** - Prints professional formatted summary: ```text ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë TEST RESULTS SUMMARY ‚ïë ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ ‚ïë Total Tests: 7 ‚ïë ‚ïë Passed: 7 ‚ïë ‚ïë Failed: 0 ‚ïë ‚ïë Success Rate: 100.00% ‚ïë ‚ïë Total Time: 234.56 ms ‚ïë ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ```text --- ### 3. Test Execution Macros #### RUN_TEST(test_func) **Inline test execution** (no separate task) ```cpp RUN_TEST(test_hal_initialization); ```text **Features**: - Executes test in current task context - Prints formatted header - Measures execution time (microseconds) - Records result in `g_test_results` - Flips GPIO14 on completion - 100ms delay after test **Use Case**: Simple tests that don't need large stack or isolation **Output**: ```text ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë Running: test_hal_initialization ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù [SUCCESS] PASSED: test_hal_initialization (12.34 ms) ```text --- #### RUN_TEST_IN_TASK(name, func, stack_size_bytes, priority) **FreeRTOS task-based test execution** ```cpp RUN_TEST_IN_TASK(\"hal_init\", test_hal_initialization, 8192, 5); ```text **Parameters**: - `name`: Test name string (for logging) - `func`: Test function pointer (`bool (*)() noexcept`) - `stack_size_bytes`: Task stack size (e.g., `8192` = 8KB) - `priority`: FreeRTOS task priority (`1-5`, typical: `5`) **Features**: - Executes test in **isolated FreeRTOS task** - Custom stack size per test - Automatic semaphore synchronization - **30-second timeout** protection - Fallback to inline execution on task creation failure - Waits for test completion before continuing - 100ms delay between tests **Use Case**: Complex tests needing large stack or isolation **Task Management**: ```cpp struct TestTaskContext { const char* test_name; bool (*test_func)() noexcept; TestResults* results; const char* tag; SemaphoreHandle_t completion_semaphore; }; void test_task_trampoline(void* param); ```text **Output**: ```text ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë Running (task): hal_init ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù [SUCCESS] PASSED (task): hal_init (12.34 ms) Test task completed: hal_init ```text **Timeout Handling**: ```cpp if (xSemaphoreTake(semaphore, pdMS_TO_TICKS(30000)) == pdTRUE) { // Test completed } else { ESP_LOGW(TAG, \"Test task timeout: %s\", name); // Still records result, continues to next test } ```text --- #### RUN_TEST_SECTION_IF_ENABLED(enabled, section_name, ...) **Conditional test section execution** ```cpp RUN_TEST_SECTION_IF_ENABLED( ENABLE_INITIALIZATION_TESTS, \"INITIALIZATION TESTS\", RUN_TEST_IN_TASK(\"hal_init\", test_hal_initialization, 8192, 5); RUN_TEST_IN_TASK(\"driver_init\", test_driver_initialization, 8192, 5); ); ```text **Parameters**: - `enabled`: Compile-time flag (`0` or `1`) - `section_name`: Display name for section - `...`: Test calls (variadic) **Features**: - **Compile-time** section enable/disable - Professional section header - **5-blink pattern** on GPIO14 at section start - Wraps multiple test calls **Output**: ```text ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë SECTION: INITIALIZATION TESTS ‚ïë ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù [GPIO14: 5 blinks] ... tests ... ```text --- #### RUN_TEST_SECTION_IF_ENABLED_WITH_PATTERN(enabled, section_name, blink_count, ...) **Conditional test section with custom blink pattern** ```cpp RUN_TEST_SECTION_IF_ENABLED_WITH_PATTERN( ENABLE_ADVANCED_TESTS, \"ADVANCED TESTS\", 3, // Custom 3-blink pattern RUN_TEST_IN_TASK(\"advanced_test\", test_advanced, 16384, 5); ); ```text **Parameters**: - `enabled`: Compile-time flag - `section_name`: Display name - `blink_count`: Custom blink count for this section - `...`: Test calls **Use Case**: Differentiate sections by blink pattern on oscilloscope --- ### 4. Test Section Configuration #### print_test_section_status(tag, module_name) Prints configuration information at test start: ```cpp print_test_section_status(TAG, \"TLE92466ED\"); ```text **Output**: ```text ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë TLE92466ED TEST CONFIGURATION ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ ‚ïë Test sections will execute based on compile-time configuration ‚ïë ‚ïë GPIO14 test progression indicator: ENABLED ‚ïë ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ```text --- ## üîß Usage Guide ### Basic Setup #### 1. Include Framework ```cpp #include \"TLE92466ED_TestFramework.hpp\" static const char* TAG = \"MyTest\"; ```text #### 2. Define Test Sections ```cpp #define ENABLE_BASIC_TESTS 1 #define ENABLE_ADVANCED_TESTS 1 #define ENABLE_STRESS_TESTS 0 // Disabled ```text #### 3. Write Test Functions ```cpp static bool test_my_feature() noexcept { ESP_LOGI(TAG, \"Testing my feature...\"); // Test logic here bool result = some_operation(); if (result) { ESP_LOGI(TAG, \"‚úÖ Feature works!\"); return true; } else { ESP_LOGE(TAG, \"‚ùå Feature failed!\"); return false; } } ```text **Requirements**: - Return type: `bool` - `noexcept` specifier - `true` = passed, `false` = failed #### 4. Create app_main() ```cpp extern \"C\" void app_main() { // Print header ESP_LOGI(TAG, \"‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\"); ESP_LOGI(TAG, \"‚ïë MY TEST SUITE ‚ïë\"); ESP_LOGI(TAG, \"‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\"); // Initialize GPIO14 init_test_progress_indicator(); // Print configuration print_test_section_status(TAG, \"MY_MODULE\"); // Run test sections RUN_TEST_SECTION_IF_ENABLED( ENABLE_BASIC_TESTS, \"BASIC TESTS\", RUN_TEST_IN_TASK(\"my_feature\", test_my_feature, 8192, 5); ); // Print results g_test_results.print_summary(TAG); // Cleanup cleanup_test_progress_indicator(); // Status message if (g_test_results.failed_tests == 0) { ESP_LOGI(TAG, \"‚úÖ ALL TESTS PASSED!\"); } else { ESP_LOGE(TAG, \"‚ùå %d TESTS FAILED!\", g_test_results.failed_tests); } vTaskDelay(pdMS_TO_TICKS(10000)); esp_restart(); } ```text --- ## üìä Advanced Usage ### Custom Test Context For tests that need shared resources: ```cpp // Global resources static MyDriver* g_driver = nullptr; static bool test_with_driver() noexcept { if (!g_driver) { ESP_LOGE(TAG, \"Driver not initialized\"); return false; } // Use driver return g_driver->doSomething(); } ```text ### Stack Size Guidelines | Test Complexity | Stack Size | Notes |----------------|-----------|-------| Simple | 4096 (4KB) | Basic operations, minimal locals | Normal | 8192 (8KB) | Standard tests (default) | Complex | 12288 (12KB) | Multiple buffers, recursion | Heavy | 16384 (16KB) | Large objects, deep call chains | ### Priority Guidelines | Priority | Use Case |----------|----------| 1-2 | Low priority background tests | 3-4 | Normal test priority | 5 | **Default**, standard tests | 6-10 | High priority, time-critical tests | ### Timeout Considerations Default timeout: **30 seconds** Modify in framework if needed: ```cpp if (xSemaphoreTake(ctx.completion_semaphore, pdMS_TO_TICKS(60000))) { // 60-second timeout for slow tests } ```text --- ## üéØ Best Practices ### 1. Test Organization ```cpp // Group related tests RUN_TEST_SECTION_IF_ENABLED( ENABLE_INITIALIZATION_TESTS, \"INITIALIZATION\", RUN_TEST_IN_TASK(\"hal\", test_hal_init, 8192, 5); RUN_TEST_IN_TASK(\"driver\", test_driver_init, 8192, 5); ); RUN_TEST_SECTION_IF_ENABLED( ENABLE_OPERATION_TESTS, \"OPERATIONS\", RUN_TEST_IN_TASK(\"read\", test_read, 8192, 5); RUN_TEST_IN_TASK(\"write\", test_write, 8192, 5); ); ```text ### 2. Clear Logging ```cpp static bool test_feature() noexcept { ESP_LOGI(TAG, \"Starting feature test...\"); ESP_LOGI(TAG, \"Step 1: Initialize\"); ESP_LOGI(TAG, \"Step 2: Execute\"); ESP_LOGI(TAG, \"Step 3: Verify\"); ESP_LOGI(TAG, \"‚úÖ Feature test passed\"); return true; } ```text ### 3. Error Reporting ```cpp static bool test_operation() noexcept { if (auto result = do_operation(); !result) { ESP_LOGE(TAG, \"‚ùå Operation failed: %s\", result.error()); return false; } return true; } ```text ### 4. Resource Cleanup ```cpp extern \"C\" void app_main() { // Setup init_test_progress_indicator(); auto* resource = create_resource(); // Tests RUN_TEST_SECTION_IF_ENABLED(...); // Cleanup (ALWAYS!) delete resource; cleanup_test_progress_indicator(); g_test_results.print_summary(TAG); } ```text --- ## üìà Performance Impact ### Memory Overhead | Component | Flash | RAM |-----------|-------|-----| Framework Code | ~8KB | ~2KB | Test Results | 0 | 32 bytes | Per Test Context | 0 | ~64 bytes (temporary) | GPIO14 State | 0 | 3 bytes | **Total** | **~8KB** | **~2KB + 64B per active task** | ### Timing Overhead | Operation | Time |-----------|------| Test Header Print | ~5ms | GPIO14 Toggle | ~50Œºs | GPIO14 Blink (5x) | ~500ms | Semaphore Operations | ~10Œºs | Result Recording | ~1Œºs | **Per Test Overhead** | **~5-10ms** | --- ## üîç Debugging ### Enable Framework Debug Output ```cpp #define TEST_FRAMEWORK_DEBUG 1 // In framework functions: #ifdef TEST_FRAMEWORK_DEBUG ESP_LOGI(\"TestFramework\", \"Debug info...\"); #endif ```text ### Monitor GPIO14 ```bash # Logic analyzer configuration Sample Rate: 1MHz Duration: 10s Trigger: Rising edge on GPIO14 ```text ### Analyze Test Timing ```cpp // Parse output for timing data grep \"PASSED\" output.log | awk '{print $NF}' ```text --- ## üîó Integration with CI/CD ### Structured Output Parsing ```bash #!/bin/bash # Extract results TOTAL=$(grep \"Total Tests:\" output.log | awk '{print $3}') PASSED=$(grep \"Passed:\" output.log | awk '{print $2}') FAILED=$(grep \"Failed:\" output.log | awk '{print $2}') SUCCESS_RATE=$(grep \"Success Rate:\" output.log | awk '{print $3}') # Exit code if [ \"$FAILED\" -gt 0 ]; then echo \"TESTS FAILED: $FAILED/$TOTAL\" exit 1 else echo \"ALL TESTS PASSED: $PASSED/$TOTAL ($SUCCESS_RATE)\" exit 0 fi ```text ### GitHub Actions Example ```yaml - name: Run Tests run: | ./scripts/flash_app.sh basic_usage Debug ./scripts/monitor_app.sh basic_usage > output.log - name: Parse Results run: | if grep \"\\[FAILED\\]\" output.log; then echo \"Tests failed!\" exit 1 fi ```text --- ## üìö References - [BasicUsageExample.cpp](../main/BasicUsageExample.cpp) - Example implementation - [HardFOC Internal TestFramework.h]( ../../../../internal/hf-internal-interface-wrap/examples/esp32/main/TestFramework.h) - Original framework --- **Framework Version**: 1.0.0 **Based on**: HardFOC Internal Interface Wrap TestFramework.h **Platform**: ESP32 (ESP-IDF v5.0+) **Status**: ‚úÖ Production Ready ",
    "url": "/hf-tle92466ed-driver/development/examples/esp32/docs/README_TEST_FRAMEWORK.html",
    
    "relUrl": "/examples/esp32/docs/README_TEST_FRAMEWORK.html"
  },"13": {
    "doc": "HF-TLE92466ED Driver",
    "title": "HF-TLE92466ED Driver",
    "content": "# HF-TLE92466ED Driver **C++23 driver for Infineon TLE92466ED Six-Channel Low-Side Solenoid Driver IC** [![License: Public Domain](https://img.shields.io/badge/license-Public%20Domain-green.svg)](LICENSE) ## üìö Table of Contents 1. [Overview](#-overview) 2. [Features](#-features) 3. [Quick Start](#-quick-start) 4. [Installation](#-installation) 5. [API Reference](#-api-reference) 6. [Examples](#-examples) 7. [Documentation](#-documentation) 8. [Contributing](#-contributing) 9. [License](#-license) ## üì¶ Overview > **üìñ [üìöüåê Live Complete Documentation](https://n3b3x.github.io/hf-tle92466ed-driver/)** - > Interactive guides, examples, and step-by-step tutorials **HF-TLE92466ED** is a modern C++23 driver for the **Infineon TLE92466ED** Six-Channel Low-Side Solenoid Driver IC. The TLE92466ED provides six independent low-side outputs for controlling solenoids, valves, and other inductive loads with precision current regulation. Each channel supports up to 2A in single mode or 4A in parallel mode, with 15-bit resolution (0.061mA steps) for precise current control. The driver uses a hardware-agnostic communication interface design, allowing it to run on any platform (ESP32, STM32, Arduino, etc.) with zero runtime overhead. It implements all major features from the TLE92466ED datasheet including Integrated Current Control (ICC), PWM frequency control, dither support, parallel channel operation, comprehensive diagnostics, and protection features. ## ‚ú® Features - ‚úÖ **Six Independent Channels**: Low-side outputs for solenoid/inductive load control - ‚úÖ **Precision Current Control**: 15-bit resolution (0.061mA steps), 0-2A single channel, 0-4A parallel mode - ‚úÖ **Integrated Current Controller (ICC)**: Automatic current regulation with configurable PWM frequency - ‚úÖ **Parallel Operation**: Channel pairs (0/3, 1/2, 4/5) for doubled current capability - ‚úÖ **Dither Support**: Configurable amplitude and frequency for precise current shaping - ‚úÖ **Comprehensive Diagnostics**: Overcurrent, overtemperature, open load, short-to-ground detection - ‚úÖ **Supply Monitoring**: VBAT, VIO, and VDD voltage monitoring with configurable thresholds - ‚úÖ **Hardware Agnostic**: SPI interface for platform independence - ‚úÖ **Modern C++23**: Using `std::expected` for type-safe error handling without exceptions - ‚úÖ **Zero Overhead**: All functions `noexcept`, freestanding-compatible ## üöÄ Quick Start ```cpp #include \"inc/tle92466ed.hpp\" #include \"inc/tle92466ed_spi_interface.hpp\" // 1. Implement the SPI interface (see platform_integration.md) class MySpi : public tle92466ed::SpiInterface { // ... implement required methods }; // 2. Create driver instance MySpi spi; tle92466ed::Driver driver(spi); // 3. Initialize and use if (auto result = driver.Init(); !result) { // Handle error return; } driver.EnterMissionMode(); driver.SetChannelMode(tle92466ed::Channel::CH0, tle92466ed::ChannelMode::ICC); driver.SetCurrentSetpoint(tle92466ed::Channel::CH0, 1500); // 1.5A driver.EnableChannel(tle92466ed::Channel::CH0, true); ``` For detailed setup, see [Installation](/hf-tle92466ed-driver/development/docs/installation.html) and [Quick Start Guide](/hf-tle92466ed-driver/development/docs/quickstart.html). ## üîß Installation 1. **Clone or copy** the driver files into your project 2. **Implement the SPI interface** for your platform (see [Platform Integration](/hf-tle92466ed-driver/development/docs/platform_integration.html)) 3. **Include the header** in your code: ```cpp #include \"inc/tle92466ed.hpp\" ``` 4. Compile with a **C++23** or newer compiler with `std::expected` support For detailed installation instructions, see [docs/installation.md](/hf-tle92466ed-driver/development/docs/installation.html). ## üìñ API Reference | Method | Description |--------|-------------| `Init()` | Initialize the driver and hardware | `EnterMissionMode()` | Enter mission mode (enables channel control) | `SetChannelMode()` | Set channel operation mode (ICC, Direct Drive, etc.) | `SetCurrentSetpoint()` | Set current setpoint for a channel | `EnableChannel()` | Enable or disable a channel | `GetChannelDiagnostics()` | Get channel diagnostic information | `GetAllFaults()` | Get comprehensive fault report | For complete API documentation, see [docs/api_reference.md](/hf-tle92466ed-driver/development/docs/api_reference.html). ## üìä Examples For ESP32 examples, see the [examples/esp32](examples/esp32/) directory. Detailed example walkthroughs are available in [docs/examples.md](/hf-tle92466ed-driver/development/docs/examples.html). ## üìö Documentation For complete documentation, see the [docs directory](/hf-tle92466ed-driver/development/docs/). ## ü§ù Contributing Pull requests and suggestions are welcome! Please follow the existing code style and include tests for new features. ## üìÑ License This project is released into the **Public Domain**. You can use, modify, and distribute it freely without any restrictions. ",
    "url": "/hf-tle92466ed-driver/development/",
    
    "relUrl": "/"
  },"14": {
    "doc": "TLE92466ED ESP32-C6 Examples",
    "title": "TLE92466ED ESP32-C6 Examples",
    "content": "# TLE92466ED ESP32-C6 Examples This directory contains comprehensive examples demonstrating the TLE92466ED driver on ESP32-C6 platform. ## üéØ Overview The ESP32-C6 examples showcase real-world usage of the TLE92466ED six-channel low-side solenoid driver with: - **Hardware-specific HAL** implementation for ESP32-C6 - **Multiple example applications** covering different use cases - **Automated build system** with configurable app types - **Comprehensive documentation** for each example - **Production-ready code** with proper error handling ## üîß Hardware Requirements ### ESP32-C6 Development Board - ESP32-C6-DevKitC-1 or compatible - USB-C cable for programming and power ### TLE92466ED Connections | TLE92466ED Pin | ESP32-C6 GPIO | Function |----------------|---------------|----------| MOSI | GPIO7 | SPI Data Out | MISO | GPIO2 | SPI Data In | SCLK | GPIO6 | SPI Clock | CS | GPIO10 | Chip Select | VDD | 3.3V | Logic Supply | VBAT | 12-24V | Power Supply | GND | GND | Ground | ### Load Connections Connect your solenoids/loads to the TLE92466ED output channels (OUT0-OUT5) with appropriate current ratings. ## üöÄ Quick Start ### 1. Prerequisites ```bash # Install ESP-IDF v5.5 curl -fsSL https://raw.githubusercontent.com/espressif/esp-idf/master/tools/install.sh | bash source ~/esp/esp-idf/export.sh # Verify installation idf.py --version ```text ### 2. Setup Repository ```bash # Clone and setup git clone --recursive https://github.com/n3b3x/hf-tle92466ed-driver.git cd hf-tle92466ed-driver/examples/esp32 # Initialize build environment ./scripts/setup_repo.sh ```text ### 3. Build and Flash ```bash # Build basic usage example (default) ./scripts/build_app.sh basic_usage Release # Flash to ESP32-C6 ./scripts/flash_app.sh basic_usage Release # Monitor output idf.py monitor ```text ## üì± Available Examples ### üü¢ Basic Examples #### `driver_integration_test` **Comprehensive Driver Integration Test Suite** - Complete driver API validation (40+ tests) - 13 test sections covering all functionality - Initialization, configuration, control, diagnostics - Multi-channel and parallel operation testing - Error condition validation - Comprehensive telemetry testing - Professional test framework with automatic result tracking - **No actual solenoids required** (driver test only) ```bash ./scripts/build_app.sh driver_integration_test Debug ./scripts/flash_app.sh driver_integration_test Debug ``` **Documentation**: [Driver Integration Test](docs/readme_driver_integration_test.md) #### `solenoid_control_test` **Real Hardware Solenoid Control Test** - Two solenoids: one single channel, one parallel pair - ADC-based current control (0-3.3V maps to 0-100% current) - Independent min/max current limits per solenoid - Real-time current adjustment based on ADC reading - Comprehensive real-time telemetry (every 1 second) - Proper parallel channel operation validation - **Requires actual solenoids and power supplies** ```bash ./scripts/build_app.sh solenoid_control_test Debug ./scripts/flash_app.sh solenoid_control_test Debug ``` **Documentation**: [Solenoid Control Test](docs/readme_solenoid_control_test.md) ### üü° Advanced Examples #### `parallel_mode` **High-current parallel channel operation** - Channel pairing (CH0/CH3, CH1/CH2, CH4/CH5) - 4A current control - Load balancing - Thermal management #### `diagnostics_test` **Comprehensive fault detection** - Overcurrent detection - Temperature monitoring - Open load detection - Short circuit detection - Real-time fault reporting #### `pwm_dither` **Precision control with PWM and dither** - Configurable PWM frequency - Dither amplitude control - Noise reduction techniques - Precision current shaping ### üîµ Application Examples #### `automotive_demo` **Automotive solenoid control** - Transmission solenoid patterns - Fuel injector timing - Valve control with feedback - Safety interlocks #### `industrial_valve` **Industrial valve control** - Proportional valve control - Position feedback integration - Flow rate control - PID control implementation ### üü† Testing Examples #### `stress_test` **Reliability and stress testing** - Continuous operation testing - Thermal cycling - Communication error injection - Recovery mechanisms #### `calibration` **Current calibration and accuracy** - Current measurement calibration - Temperature compensation - Accuracy validation - Factory calibration routines ## üõ†Ô∏è Build System ### App Configuration All examples are configured in `app_config.yml`: ```yaml apps: basic_usage: description: \"Basic TLE92466ED usage example\" source_file: \"BasicUsageExample.cpp\" category: \"basic\" idf_versions: [\"release/v5.5\"] build_types: [\"Debug\", \"Release\"] ```text ### Build Commands ```bash # List available apps python3 scripts/get_app_info.py list # Get app information python3 scripts/get_app_info.py info basic_usage # Build specific app and type ./scripts/build_app.sh # Flash specific app ./scripts/flash_app.sh # Clean build ./scripts/build_app.sh --clean ```text ### Build Types - **Debug**: Full debugging symbols, verbose logging, assertions - **Release**: Optimized for performance and size - **RelWithDebInfo**: Release with debug symbols - **MinSizeRel**: Optimized for minimum size ## üìä Configuration ### Hardware Configuration File All hardware configuration is defined in `main/TLE92466ED_TestConfig.hpp`. This is the **actual** configuration used by the HAL and examples. **Important**: The `app_config.yml` file only contains application definitions and build configuration, NOT hardware settings. ### SPI Configuration Edit `main/TLE92466ED_TestConfig.hpp` to change SPI pins: ```cpp struct SPIPins { static constexpr int MISO = 2; // GPIO2 - SPI MISO static constexpr int MOSI = 7; // GPIO7 - SPI MOSI static constexpr int SCLK = 6; // GPIO6 - SPI Clock static constexpr int CS = 10; // GPIO10 - Chip Select }; struct SPIParams { static constexpr int FREQUENCY = 1000000; // 1MHz static constexpr int MODE = 0; // SPI Mode 0 }; ```text ### Current Limits Defined in `main/TLE92466ED_TestConfig.hpp`: ```cpp struct CurrentLimits { static constexpr uint16_t SINGLE_CHANNEL_MAX = 2000; // 2A per channel static constexpr uint16_t PARALLEL_CHANNEL_MAX = 4000; // 4A parallel mode }; ```text ### Hardware Specifications Defined in `main/TLE92466ED_TestConfig.hpp`: ```cpp struct SupplyVoltage { static constexpr float VBAT_MIN = 8.0f; // Minimum VBAT (V) static constexpr float VBAT_MAX = 28.0f; // Maximum VBAT (V) }; struct Temperature { static constexpr int JUNCTION_MAX = 150; // Maximum temp (¬∞C) }; ```text ## üîç Debugging ### Serial Monitor ```bash # Monitor with automatic port detection idf.py monitor # Monitor specific port idf.py monitor -p /dev/ttyUSB0 # Monitor with filtering idf.py monitor | grep \"TLE92466ED\" ```text ### Log Levels Set in `sdkconfig` or via menuconfig: ```text CONFIG_LOG_DEFAULT_LEVEL_DEBUG=y # Debug level CONFIG_TLE92466ED_DEBUG_ENABLED=y # Driver debug ```text ### Common Issues 1. **SPI Communication Errors** - Check wiring connections - Verify power supply (VBAT 12-24V, VDD 3.3V) - Ensure proper grounding 2. **Current Control Issues** - Verify load connections - Check current limits in configuration - Monitor diagnostics for faults 3. **Build Errors** - Ensure ESP-IDF v5.5 is installed - Run `./scripts/setup_repo.sh` - Check C++23 compiler support ## üìö Documentation ### Example Documentation Each example has detailed documentation in `docs/`: - `docs/readme_driver_integration_test.md` - `docs/README_MULTI_CHANNEL.md` - `docs/README_PARALLEL_MODE.md` - `docs/README_DIAGNOSTICS.md` - And more... ### API Documentation - [Driver API Reference](../../docs/07_Driver_API.md) - [HAL Implementation Guide](../../docs/08_HAL_Implementation.md) - [Register Map](../../docs/03_Register_Map.md) ## üß™ Testing ### Unit Tests ```bash # Run all tests ./scripts/build_app.sh stress_test Debug ./scripts/flash_app.sh stress_test Debug ```text ### Performance Testing ```bash # Performance monitoring ./scripts/build_app.sh multi_channel Release ./scripts/flash_app.sh multi_channel Release ```text ### Continuous Integration The examples are automatically tested in CI with: - Multiple ESP-IDF versions - Debug and Release builds - Hardware-in-the-loop testing ## ü§ù Contributing 1. **Adding New Examples** - Create source file in `main/` - Add entry to `app_config.yml` - Create documentation in `docs/` - Test with both Debug and Release builds 2. **Modifying HAL** - Update `ESP32C6_HAL.hpp` and `ESP32C6_HAL.cpp` - Ensure compatibility with all examples - Test SPI communication thoroughly 3. **Configuration Changes** - Update `app_config.yml` for new settings - Modify `sdkconfig` for ESP32-C6 specific changes - Document changes in README ## üìÑ License This software is released into the **Public Domain**. You can use, modify, and distribute it freely without any restrictions. ## üîó Resources - [TLE92466ED Datasheet](../../Datasheet/) - [ESP32-C6 Technical Reference](https://www.espressif.com/sites/default/files/documentation/esp32-c6_technical_reference_manual_en.pdf) - [ESP-IDF Programming Guide](https://docs.espressif.com/projects/esp-idf/en/latest/) - [GitHub Repository](https://github.com/n3b3x/hf-tle92466ed-driver) --- **Version**: 2.0.0 | **Target**: ESP32-C6 | **ESP-IDF**: v5.5 | **Last Updated**: 2025-10-21 ",
    "url": "/hf-tle92466ed-driver/development/examples/esp32/",
    
    "relUrl": "/examples/esp32/"
  },"15": {
    "doc": "TLE92466ED ESP-IDF Component",
    "title": "TLE92466ED ESP-IDF Component",
    "content": "# TLE92466ED ESP-IDF Component This directory contains the ESP-IDF component configuration for the TLE92466ED driver. ## Overview This component wraps the TLE92466ED driver for use as an ESP-IDF managed component, making it easy to integrate into ESP32 projects. ## Component Structure ```text tle92466ed-espidf/ ‚îú‚îÄ‚îÄ CMakeLists.txt # Component build configuration ‚îú‚îÄ‚îÄ idf_component.yml # ESP-IDF Component Manager manifest ‚îî‚îÄ‚îÄ README.md # This file ```text ## How It Works ### Component Resolution The component automatically locates the TLE92466ED driver source files: 1. **CI/Build Environment**: Looks for `src/` and `include/` in the project root 2. **Development Environment**: Looks for `../../src/` and `../../include/` (driver root) ### Source Files Included - `src/TLE92466ED.cpp` - Main driver implementation ### Headers Included - `inc/TLE92466ED.hpp` - Driver class - `inc/TLE92466ED_Registers.hpp` - Register definitions - `inc/TLE92466ED_CommInterface.hpp` - Communication interface ## Usage in Projects ### In ESP-IDF Component Manager This component can be used with the ESP-IDF Component Manager by adding it to your project's dependencies. ### In Local Projects The component is automatically discovered by ESP-IDF when located in the `components/` directory of your project. ### Requirements Add to your main component: ```cmake idf_component_register( SRCS \"main.cpp\" INCLUDE_DIRS \".\" REQUIRES tle92466ed-espidf # Add this requirement ) ```text ## Configuration The component provides compile-time definitions based on the target: - `TLE92466ED_TARGET_ESP32` - ESP32 classic target - `TLE92466ED_TARGET_ESP32C6` - ESP32-C6 target - `TLE92466ED_TARGET_ESP32S3` - ESP32-S3 target - `TLE92466ED_TARGET_ESP32C3` - ESP32-C3 target - `TLE92466ED_MCU_FAMILY_ESP32` - ESP32 family marker ## Build Features ### C++23 Standard The component is configured to use C++23 standard: ```cmake target_compile_features(${COMPONENT_LIB} PRIVATE cxx_std_23) ```text ### Compiler Optimizations - **Link Time Optimization (LTO)**: Enabled when configured - **Function/Data Sections**: For better code size optimization - **No RTTI**: `-fno-rtti` for smaller binary size - **No Exceptions**: `-fno-exceptions` for embedded systems ### Compiler Flags ```text -Wall -Wextra -Wpedantic -O2 -g -ffunction-sections -fdata-sections -fno-rtti -fno-exceptions ```text ## ESP-IDF Dependencies The component requires these ESP-IDF components: ### Core Components - `driver` - SPI drivers - `esp_timer` - Timing functions - `freertos` - RTOS support - `esp_system` - System utilities - `hal` - Hardware abstraction layer - `soc` - SoC definitions - `log` - Logging ### Driver Components - `esp_driver_gpio` - GPIO driver - `esp_driver_spi` - SPI driver ## Supported ESP32 Targets - ESP32 (classic) - ESP32-S2 - ESP32-S3 - ESP32-C2 - ESP32-C3 - ESP32-C6 (primary target) - ESP32-H2 ## Development ### Testing Component Configuration ```bash cd examples/esp32 idf.py reconfigure ```text ### Viewing Component Information ```bash idf.py show-components ```text ### Debugging Component Issues Enable verbose output: ```bash idf.py -v build ```text ## Component Manager ### Publishing to Component Registry To publish this component to the ESP-IDF Component Registry: 1. Update version in `idf_component.yml` 2. Create git tag matching version 3. Follow ESP-IDF Component Manager publishing guidelines ### Local Installation The component is automatically available when building the examples from the `examples/esp32` directory. ## Build Messages During build, the component will display: ```text TLE92466ED Driver - ESP32 Component Configuration Project Root: /path/to/project Source Root: /path/to/driver Found source: /path/to/TLE92466ED.cpp === TLE92466ED Driver Component Summary === Component configured successfully Included 1 source files Target MCU: ESP32-C6 C++ Standard: C++23 Driver Version: 2.0.0 Optimization: LTO enabled (if configured) ========================================== ```text ## Troubleshooting ### Source Files Not Found **Issue**: \"Source file not found\" warnings **Solution**: Verify the driver is in the correct location: - Development: `../../src/TLE92466ED.cpp` relative to component - CI: `${PROJECT_ROOT}/src/TLE92466ED.cpp` ### C++23 Not Supported **Issue**: Compiler doesn't support C++23 **Solution**: Update to: - GCC 12.0 or later - Clang 16.0 or later - ESP-IDF v5.5 or later ### Component Not Found **Issue**: \"Component 'tle92466ed-espidf' not found\" **Solution**: Ensure the component is in the `components/` directory of your ESP-IDF project. ## References - [ESP-IDF Component Manager Documentation](https://docs.espressif.com/projects/idf-component-manager/) - [ESP-IDF CMake Build System](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/build-system.html) - [TLE92466ED Driver Documentation](../../docs/) --- **Component Version**: 2.0.0 **ESP-IDF Version**: ‚â•5.0.0 **C++ Standard**: C++23 ",
    "url": "/hf-tle92466ed-driver/development/examples/esp32/components/hf_tle92466ed/",
    
    "relUrl": "/examples/esp32/components/hf_tle92466ed/"
  },"16": {
    "doc": "TLE92466ED ESP32 Examples Documentation",
    "title": "TLE92466ED ESP32 Examples Documentation",
    "content": "# TLE92466ED ESP32 Examples Documentation ## üìö Documentation Index Complete documentation for TLE92466ED driver examples on ESP32-C6. --- ## üéØ Quick Start | Document | Purpose | When to Read |----------|---------|--------------| **[Driver Integration Test](readme_driver_integration_test.md)** | Driver API validation | Start here for driver testing | **[Solenoid Control Test](readme_solenoid_control_test.md)** | Real hardware solenoid testing | For actual solenoid operation | **[Configuration Guide](readme_configuration.md)** | All configuration options | Before customizing | **[Test Framework Reference](/hf-tle92466ed-driver/development/examples/esp32/docs/README_TEST_FRAMEWORK.html)** | Framework API details | Writing custom tests | --- ## üìñ Documentation Structure ### 1. [Driver Integration Test Suite](readme_driver_integration_test.md) **Guide to the driver integration test suite** #### Contents - ‚úÖ **Test Framework Architecture** - How the test infrastructure works - ‚úÖ **Test Suite Structure** - All 13 test sections with 40+ tests - ‚úÖ **Hardware Setup** - Complete wiring diagrams and pin configurations - ‚úÖ **Configuration** - Hardware and test settings - ‚úÖ **Building and Running** - Build commands and workflows - ‚úÖ **Expected Output** - Full example outputs with explanations - ‚úÖ **Test Coverage** - Complete API coverage breakdown - ‚úÖ **Individual Test Details** - Deep dive into each test - ‚úÖ **Telemetry Testing** - Telemetry validation - ‚úÖ **Troubleshooting** - Common issues and solutions - ‚úÖ **Performance Characteristics** - Timing and memory usage **Start here for driver API validation (no hardware required)!** --- ### 2. [Solenoid Control Test](readme_solenoid_control_test.md) **Complete guide to real hardware solenoid testing** #### Contents - ‚úÖ **Hardware Requirements** - Complete component list and specifications - ‚úÖ **System Architecture** - Block diagrams and control flow - ‚úÖ **Hardware Setup** - Detailed wiring diagrams and connections - ‚úÖ **ADC Configuration** - Analog input setup and calibration - ‚úÖ **Solenoid Configuration** - Single channel and parallel pair setup - ‚úÖ **Control Algorithm** - Current calculation and regulation - ‚úÖ **Real-Time Telemetry** - Monitoring and display - ‚úÖ **Operation** - Startup sequence and control loop - ‚úÖ **Troubleshooting** - Hardware-specific issues and solutions - ‚úÖ **Safety Considerations** - Electrical and operational safety **Use this for real hardware testing with actual solenoids!** --- ### 3. [Configuration Guide](readme_configuration.md) **Complete reference for all configuration files and options** #### Contents - ‚úÖ **Hardware Configuration** (`TLE92466ED_TestConfig.hpp`) - SPI pins, frequencies, current limits - ‚úÖ **Application Configuration** (`app_config.yml`) - Build metadata and app definitions - ‚úÖ **Test Section Configuration** - Compile-time test enable/disable - ‚úÖ **ESP-IDF SDK Configuration** (`sdkconfig`) - Framework settings - ‚úÖ **Component Configuration** - ESP-IDF component setup - ‚úÖ **Configuration Workflows** - Development and production setups - ‚úÖ **Troubleshooting** - Configuration-related issues **Read this when you need to customize hardware or build settings.** --- ### 4. [Test Framework Reference](/hf-tle92466ed-driver/development/examples/esp32/docs/README_TEST_FRAMEWORK.html) **Detailed API reference for the TLE92466ED Test Framework** #### Contents - ‚úÖ **GPIO14 Progress Indicator** - Visual feedback system - ‚úÖ **Test Result Tracking** - Automatic pass/fail counting - ‚úÖ **Test Execution Macros** - `RUN_TEST`, `RUN_TEST_IN_TASK`, sections - ‚úÖ **Usage Guide** - How to write test functions - ‚úÖ **Advanced Usage** - Custom contexts, stack sizes, timeouts - ‚úÖ **Best Practices** - Test organization - ‚úÖ **Performance Impact** - Memory and timing overhead - ‚úÖ **CI/CD Integration** - Automated testing **Essential reading for creating custom tests or understanding the framework.** --- ## üöÄ Getting Started ### Prerequisites - **Hardware**: - ESP32-C6-DevKitC-1 development board - TLE92466ED evaluation board or custom PCB - 12-24V power supply (2A minimum) - Test load (solenoid, resistor, or LED) - USB-C cable for programming - **Software**: - ESP-IDF v5.3 or later (v5.5 recommended) - Python 3.8+ - Git with submodules support - Serial terminal (screen, minicom, or built-in monitor) ### Quick Start Steps 1. **Clone and setup**: ```bash git clone https://github.com/N3b3x/hf-tle92466ed-driver.git cd hf-tle92466ed-driver/examples/esp32 git submodule update --init --recursive ``` 2. **Configure ESP-IDF**: ```bash . $IDF_PATH/export.sh idf.py set-target esp32c6 ``` 3. **Build driver integration test**: ```bash ./scripts/build_app.sh driver_integration_test Debug ``` 4. **Flash and monitor**: ```bash ./scripts/flash_app.sh driver_integration_test Debug ./scripts/monitor_app.sh driver_integration_test ``` 5. **See results**: - Serial output shows test execution - GPIO14 toggles with test progress - Summary printed at end --- ## üìä Example Overview ### Driver Integration Test **Purpose**: Driver API validation without hardware requirements **Test Sections** (13 total): 1. **INITIALIZATION_TESTS** - HAL setup, driver init, chip ID verification 2. **MODE_CONTROL_TESTS** - Mode transitions and state management 3. **GLOBAL_CONFIGURATION_TESTS** - Global device configuration 4. **CHANNEL_CONTROL_TESTS** - Channel enable/disable and mode configuration 5. **CURRENT_CONTROL_TESTS** - Current setpoint control and ramping 6. **PWM_CONFIGURATION_TESTS** - PWM period configuration 7. **DITHER_CONFIGURATION_TESTS** - Dither configuration 8. **DIAGNOSTICS_TESTS** - Telemetry and diagnostics 9. **FAULT_MANAGEMENT_TESTS** - Fault handling 10. **WATCHDOG_TESTS** - Watchdog functionality 11. **GPIO_CONTROL_TESTS** - GPIO pin control 12. **MULTI_CHANNEL_TESTS** - All channels individually tested 13. **PARALLEL_OPERATION_TESTS** - Parallel pair configuration 14. **ERROR_CONDITION_TESTS** - Error handling validation **Features**: - ‚úÖ 40+ individual tests - ‚úÖ Complete API coverage - ‚úÖ FreeRTOS task-based test execution - ‚úÖ GPIO14 progress indicator - ‚úÖ Automatic result tracking - ‚úÖ Telemetry testing - ‚úÖ Formatted output - ‚úÖ No actual solenoids required **Read**: [Driver Integration Test](readme_driver_integration_test.md) --- ### Solenoid Control Test **Purpose**: Real hardware solenoid testing with ADC-based current control **Features**: - ‚úÖ Two solenoids: single channel and parallel pair - ‚úÖ ADC-based control (0-3.3V ‚Üí 0-100% current) - ‚úÖ Independent current ranges per solenoid - ‚úÖ Real-time telemetry (every 1 second) - ‚úÖ Continuous operation - ‚úÖ Fault monitoring **Hardware Required**: TLE92466ED IC + Two Solenoids + Power Supplies **Read**: [Solenoid Control Test](readme_solenoid_control_test.md) --- ## üîß Configuration Overview ### Hardware Configuration **File**: `main/TLE92466ED_TestConfig.hpp` **What's configured**: - SPI GPIO pins (MISO, MOSI, SCLK, CS) - SPI frequency and mode - Current limits (single and parallel) - Hardware specifications (voltage, temperature) - Test parameters **Example**: ```cpp struct SPIPins { static constexpr int MISO = 2; // GPIO2 static constexpr int MOSI = 7; // GPIO7 static constexpr int SCLK = 6; // GPIO6 static constexpr int CS = 10; // GPIO10 }; ```text **Read**: [Configuration Guide - Hardware Configuration](readme_configuration.md#1-hardware-configuration-maintle92466ed_confighpp) --- ### Build Configuration **File**: `app_config.yml` **What's configured**: - Available applications (basic_usage, multi_channel, etc.) - Build types (Debug, Release) - ESP-IDF version compatibility - CI/CD settings - Documentation links **Example**: ```yaml apps: basic_usage: description: \"Basic usage example for TLE92466ED\" source_file: \"BasicUsageExample.cpp\" build_types: [\"Debug\", \"Release\"] ```text **Read**: [Configuration Guide - Application Configuration](readme_configuration.md#2-application-configuration-app_configyml) --- ### Test Configuration **File**: Each example source file (e.g., `BasicUsageExample.cpp`) **What's configured**: - Test section enable/disable flags - Compile-time test selection **Example**: ```cpp #define ENABLE_INITIALIZATION_TESTS 1 // Enable #define ENABLE_BASIC_OPERATION_TESTS 1 // Enable #define ENABLE_CURRENT_CONTROL_TESTS 0 // Disable ```text **Read**: [Configuration Guide - Test Section Configuration](readme_configuration.md#3-test-section-configuration) --- ## üß™ Test Framework Features The examples use a test framework with: #### ‚úÖ FreeRTOS Task-Based Execution - Each test runs in isolated task - Custom stack size per test (default: 8KB) - Automatic semaphore synchronization - 30-second timeout protection #### ‚úÖ GPIO14 Progress Indicator - **Visual feedback** on oscilloscope/logic analyzer - **Toggle**: HIGH/LOW on test completion - **Blink patterns**: 5 blinks at section boundaries - Hardware-level progress tracking #### ‚úÖ Automatic Result Tracking - Pass/fail counting - Microsecond-precision execution timing - Success rate calculation - Formatted summaries #### ‚úÖ Test Section Management - Compile-time section enable/disable - Organized test grouping - Custom blink patterns per section **Read**: [Test Framework Reference](/hf-tle92466ed-driver/development/examples/esp32/docs/README_TEST_FRAMEWORK.html) --- ## üìà Example Output ### Test Execution ```text ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë TLE92466ED BASIC USAGE TEST SUITE - ESP32-C6 ‚ïë ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù Target: esp32c6 ESP-IDF Version: v5.5.0 ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë SECTION: INITIALIZATION TESTS ‚ïë ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù [GPIO14: Blink pattern - 5 blinks] ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë Running (task): hal_initialization ‚ïë ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù I (1234) TLE92466ED_Basic: Creating HAL instance... I (1235) TLE92466ED_Basic: ‚úÖ HAL initialized successfully [SUCCESS] PASSED (task): hal_initialization (12.34 ms) [GPIO14: Toggle HIGH] ... (more tests) ... ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë TEST RESULTS SUMMARY ‚ïë ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ ‚ïë Total Tests: 7 ‚ïë ‚ïë Passed: 7 ‚ïë ‚ïë Failed: 0 ‚ïë ‚ïë Success Rate: 100.00% ‚ïë ‚ïë Total Time: 234.56 ms ‚ïë ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù I (5000) TLE92466ED_Basic: ‚úÖ ALL TESTS PASSED! ```text --- ## üêõ Troubleshooting Quick Reference ### Common Issues | Issue | Quick Fix | Full Guide |-------|-----------|------------| **All tests fail** | Check VIO power (3.0-5.5V, typical 3.3V) and wiring | [Driver Integration Test - Troubleshooting](readme_driver_integration_test.md#troubleshooting) | **HAL init fails** | Verify GPIO pins in `TLE92466ED_TestConfig.hpp` | [Configuration - GPIO Conflict](readme_configuration.md#gpio-conflict) | **Chip ID read fails** | Check SPI wiring, CS pin, RESN pin | [Driver Integration Test - Troubleshooting](readme_driver_integration_test.md#troubleshooting) | **Solenoids not working** | Check VBAT, EN pin, channel enable | [Solenoid Control Test - Troubleshooting](readme_solenoid_control_test.md#troubleshooting) | **Stack overflow** | Increase stack size in `RUN_TEST_IN_TASK` | [Configuration - Stack Overflow](readme_configuration.md#stack-overflow) | **Build errors** | Clean and rebuild: `idf.py fullclean && idf.py build` | [Configuration - Build Type Issues](readme_configuration.md#build-type-issues) | --- ## üì¶ Project Structure ```text examples/esp32/ ‚îú‚îÄ‚îÄ app_config.yml # Build metadata ‚îú‚îÄ‚îÄ CMakeLists.txt # Main CMake configuration ‚îú‚îÄ‚îÄ sdkconfig # ESP-IDF SDK configuration ‚îÇ ‚îú‚îÄ‚îÄ main/ # Application source ‚îÇ ‚îú‚îÄ‚îÄ CMakeLists.txt # Main component build ‚îÇ ‚îú‚îÄ‚îÄ TLE92466ED_TestConfig.hpp # Hardware configuration ‚îÇ ‚îú‚îÄ‚îÄ TLE92466ED_TestFramework.hpp # Test infrastructure ‚îÇ ‚îú‚îÄ‚îÄ ESP32C6_HAL.hpp/.cpp # ESP32-C6 HAL implementation ‚îÇ ‚îú‚îÄ‚îÄ DriverIntegrationTest.cpp # Driver integration test suite ‚îÇ ‚îî‚îÄ‚îÄ SolenoidControlTest.cpp # Real hardware solenoid test ‚îÇ ‚îú‚îÄ‚îÄ components/ # ESP-IDF components ‚îÇ ‚îî‚îÄ‚îÄ hf_tle92466ed/ # TLE92466ED driver component ‚îÇ ‚îú‚îÄ‚îÄ CMakeLists.txt ‚îÇ ‚îú‚îÄ‚îÄ idf_component.yml ‚îÇ ‚îî‚îÄ‚îÄ README.md ‚îÇ ‚îú‚îÄ‚îÄ docs/ # Documentation ‚îÇ ‚îú‚îÄ‚îÄ README.md # This file ‚îÇ ‚îú‚îÄ‚îÄ readme_driver_integration_test.md # Driver integration test guide ‚îÇ ‚îú‚îÄ‚îÄ readme_solenoid_control_test.md # Solenoid control test guide ‚îÇ ‚îú‚îÄ‚îÄ readme_configuration.md # Configuration reference ‚îÇ ‚îî‚îÄ‚îÄ README_TEST_FRAMEWORK.md # Test framework API ‚îÇ ‚îî‚îÄ‚îÄ scripts/ # Build/flash scripts (submodule) ‚îú‚îÄ‚îÄ build_app.sh ‚îú‚îÄ‚îÄ flash_app.sh ‚îî‚îÄ‚îÄ monitor_app.sh ```text --- ## üîó Related Documentation ### Driver Documentation - [Driver Overview](/hf-tle92466ed-driver/development/) - Main driver README - [Driver API Reference](../../../docs/07_Driver_API.md) - Complete API docs - [HAL Implementation Guide](../../../docs/08_HAL_Implementation.md) - Porting guide - [Register Map](../../../docs/03_Register_Map.md) - TLE92466ED registers - [Diagnostics](../../../docs/06_Diagnostics.md) - Fault detection ### ESP32 Resources - [ESP-IDF Programming Guide](https://docs.espressif.com/projects/esp-idf/en/latest/) - [ESP32-C6 Technical Reference](https://www.espressif.com/sites/default/files/documentation/esp32-c6_technical_reference_manual_en.pdf) - [FreeRTOS Documentation](https://www.freertos.org/Documentation/RTOS_book.html) ### TLE92466ED Resources - [TLE92466ED Datasheet](../../../Datasheet/) - [Infineon Product Page](https://www.infineon.com/cms/en/product/power/motor-control-ics/intelligent-motor-control-ics/multi-half-bridge-ics/tle92466ed/) --- ## üéì Learning Path ### Beginner Path 1. **Read**: [Driver Integration Test](readme_driver_integration_test.md) 2. **Build**: Driver integration test (Debug mode) 3. **Run**: Flash to ESP32-C6 and observe output 4. **Verify**: All tests should pass (100% success rate) 5. **Explore**: Review telemetry tests and diagnostics ### Intermediate Path 1. **Read**: [Solenoid Control Test](readme_solenoid_control_test.md) 2. **Setup**: Connect solenoids and power supplies 3. **Configure**: Adjust solenoid current ranges if needed 4. **Test**: Run solenoid control test with real hardware 5. **Monitor**: Observe real-time telemetry and current regulation ### Advanced Path 1. **Read**: [Test Framework Reference](/hf-tle92466ed-driver/development/examples/esp32/docs/README_TEST_FRAMEWORK.html) 2. **Extend**: Add custom test functions 3. **Port**: Implement HAL for different MCU (ESP32-S3, etc.) 4. **Integrate**: Set up CI/CD pipeline with test parsing 5. **Optimize**: Profile and optimize for your application --- ## üí° Tips and Best Practices ### Development Tips 1. **Start with Debug builds** for detailed logging 2. **Use GPIO14 indicator** to track progress without serial 3. **Monitor SPI signals** with logic analyzer during bring-up 4. **Test with known-good load** (resistor) before real solenoids 5. **Enable all test sections** initially, disable as needed ### Configuration Tips 1. **Keep hardware config centralized** in `TLE92466ED_TestConfig.hpp` 2. **Use compile-time flags** for test sections (faster than runtime) 3. **Document custom settings** in code comments 4. **Version control sdkconfig.defaults** for team consistency 5. **Use Release builds** for final performance testing ### Testing Tips 1. **Run full test suite** after any changes 2. **Check GPIO14 patterns** on oscilloscope for test flow 3. **Analyze execution times** to find performance issues 4. **Test with realistic loads** matching your application 5. **Monitor diagnostics** for fault conditions --- ## üÜò Getting Help ### Documentation Issues If documentation is unclear or incomplete: 1. Check the specific guide (Basic Usage, Configuration, Test Framework) 2. Search for keywords in all docs 3. Review related driver documentation 4. Open GitHub issue with details ### Build/Configuration Issues If you have build or configuration problems: 1. Check [Configuration Guide - Troubleshooting](readme_configuration.md#troubleshooting-configuration) 2. Verify ESP-IDF version (v5.3+) 3. Clean and rebuild: `idf.py fullclean && idf.py build` 4. Check `sdkconfig` for conflicts ### Hardware/Test Issues If tests fail or hardware doesn't work: 1. **Driver Integration Test**: Check [Driver Integration Test - Troubleshooting](readme_driver_integration_test.md#troubleshooting) 2. **Solenoid Control Test**: Check [Solenoid Control Test - Troubleshooting](readme_solenoid_control_test.md#troubleshooting) 3. Verify wiring against pin configuration 4. Measure power supplies (VDD: 5V for central logic; VIO: 3.0-5.5V for SPI I/O levels; VBAT: 5.5-41V for solenoids) 5. Test SPI communication with logic analyzer 6. Try lower SPI frequency (100kHz) for debugging ### Support Channels - **GitHub Issues**: Bug reports, feature requests - **GitHub Discussions**: Questions, general help - **Driver Documentation**: Technical reference --- ## üìä Example Statistics ### Driver Integration Test | Metric | Value |--------|-------| **Total Tests** | 40+ | **Test Sections** | 13 | **Typical Execution Time** | 10-15 seconds | **Flash Size** | ~350KB | **RAM Usage** | ~15KB | **Stack per Task** | 8KB | ### Test Breakdown | Section | Tests | Time |---------|-------|------| **Initialization** | 5 | ~50-100ms | **Mode Control** | 3 | ~30-50ms | **Global Configuration** | 3 | ~200-300ms | **Channel Control** | 4 | ~500-800ms | **Current Control** | 2 | ~2000-3000ms | **PWM Configuration** | 2 | ~300-500ms | **Dither Configuration** | 2 | ~300-500ms | **Diagnostics** | 7 | ~1000-1500ms | **Fault Management** | 2 | ~100-200ms | **Watchdog** | 1 | ~200-300ms | **GPIO Control** | 1 | ~200-300ms | **Multi-Channel** | 1 | ~2000-3000ms | **Parallel Operation** | 1 | ~300-500ms | **Error Conditions** | 1 | ~100-200ms | ### Solenoid Control Test | Metric | Value |--------|-------| **Control Update Rate** | 10 Hz (100ms) | **Telemetry Update Rate** | 1 Hz (1 second) | **ADC Sampling Rate** | 1 kHz | **Flash Size** | ~380KB | **RAM Usage** | ~18KB | **Stack** | 8KB | --- ## üéâ Success Criteria You've successfully set up the examples when: - ‚úÖ Build completes without errors - ‚úÖ Flash and monitor show output - ‚úÖ All tests pass (100% success rate) - ‚úÖ GPIO14 toggles during execution - ‚úÖ Test summary shows timing information - ‚úÖ System restarts automatically after tests Example success output: ```text ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó ‚ïë TEST RESULTS SUMMARY ‚ïë ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£ ‚ïë Total Tests: 7 ‚ïë ‚ïë Passed: 7 ‚ïë ‚ïë Failed: 0 ‚ïë ‚ïë Success Rate: 100.00% ‚ïë ‚ïë Total Time: 234.56 ms ‚ïë ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚úÖ ALL TESTS PASSED! System will restart in 10 seconds... ```text --- **Documentation Version**: 1.0.0 **Last Updated**: 2025-10-21 **Status**: ‚úÖ Complete **Next**: Start with [Driver Integration Test](readme_driver_integration_test.md) ‚Üí ",
    "url": "/hf-tle92466ed-driver/development/examples/esp32/docs/",
    
    "relUrl": "/examples/esp32/docs/"
  }
}
